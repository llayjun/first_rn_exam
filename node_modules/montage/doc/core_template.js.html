<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: core/template.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: core/template.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>var Montage = require("./core").Montage,
    Deserializer = require("core/serialization/deserializer/montage-deserializer").MontageDeserializer,
    DocumentPart = require("./document-part").DocumentPart,
    DocumentResources = require("./document-resources").DocumentResources,
    Serialization = require("./serialization/serialization").Serialization,
    MontageLabeler = require("./serialization/serializer/montage-labeler").MontageLabeler,
    Promise = require("./promise").Promise,
    URL = require("./mini-url"),
    logger = require("./logger").logger("template"),
    defaultEventManager = require("./event/event-manager").defaultEventManager,
    defaultApplication;

/**
 * @class Template
 * @extends Montage
 */
var Template = Montage.specialize( /** @lends Template# */ {
    _SERIALIZATION_SCRIPT_TYPE: {value: "text/montage-serialization"},
    _ELEMENT_ID_ATTRIBUTE: {value: "data-montage-id"},
    PARAM_ATTRIBUTE: {value: "data-param"},

    _require: {value: null},
    _resources: {value: null},
    _baseUrl: {value: null},
    _instances: {value: null},
    _metadata: {value: null},

    _objectsString: {value: null},
    objectsString: {
        get: function () {
            return this._objectsString;
        },
        set: function (value) {
            this._objectsString = value;
            if (this._serialization) {
                this._serialization.initWithString(value);
            }
            // Invalidate the deserializer cache since there's a new
            // serialization in town.
            this.__deserializer = null;
        }
    },

    // Deserializer cache
    __deserializer: {value: null},
    _deserializer: {
        get: function () {
            var deserializer = this.__deserializer,
                metadata,
                requires;

            if (!deserializer) {
                metadata = this._metadata;
                if (metadata) {
                    requires = Object.create(null);

                    /* jshint forin: true */
                    for (var label in metadata) {
                    /* jshint forin: false */
                        requires[label] = metadata[label].require;
                    }
                }
                deserializer = new Deserializer().init(this.objectsString,
                    this._require, requires);
                this.__deserializer = deserializer;
            }

            return deserializer;
        }
    },
    getDeserializer: {
        value: function () {
            return this._deserializer;
        }
    },

    _serialization: {
        value: null
    },
    getSerialization: {
        value: function () {
            var serialiation = this._serialization;

            if (!serialiation) {
                serialiation = this._serialization = new Serialization();
                serialiation.initWithString(this.objectsString);
            }

            return serialiation;
        }
    },

    _isDirty: {
        value: false
    },

    isDirty: {
        get: function () {
            return this._isDirty;
        },
        set: function (value) {
            if (this._isDirty !== value) {
                this._isDirty = value;
                this.clearTemplateFromElementContentsCache();
            }
        }
    },

    /**
     * Object that knows how to refresh the contents of the template when it's
     * dirty. Expected to implement the refreshTemplate(template) function.
     */
    refresher: {
        value: null
    },

    _document: {
        value: null
    },

    document: {
        get: function () {
            if (this._isDirty) {
                this.refresh();
            }
            return this._document;
        },
        set: function (value) {
            this._document = value;
        }
    },

    /**
     * Initializes the Template with an empty document.
     *
     * @function
     * @param {require} _require The require function used to load modules when
     *                           a template is instantiated.
     */
    initWithRequire: {
        value: function (_require) {
            this._require = _require;
            this.document = this.createHtmlDocumentWithHtml("");
            this.objectsString = "";

            return this;
        }
    },

    /**
     * Initializes the Template with a document.
     *
     * @function
     * @param {HTMLDocument} _document The document to be used as a template.
     * @param {require} _require The require function used to load modules when
     *                           a template is instantiated.
     * @returns {Promise} A promise for the proper initialization of the
     *                    template.
     */
    initWithDocument: {
        value: function (_document, _require) {
            var self = this;

            this._require = _require;
            this.setDocument(_document);

            return this.getObjectsString(_document)
            .then(function (objectsString) {
                self.objectsString = objectsString;
                return self;
            });
        }
    },

    /**
     * Initializes the Template with an HTML string.
     *
     * @function
     * @param {HTMLDocument} html The HTML string to be used as a template.
     * @param {require} _require The require function used to load modules when
     *                           a template is instantiated.
     * @returns {Promise} A promise for the proper initialization of the
     *                    template.
     */
    initWithHtml: {
        value: function (html, _require) {
            var self = this;

            this._require = _require;
            this.document = this.createHtmlDocumentWithHtml(html);

            return this.getObjectsString(this.document)
            .then(function (objectsString) {
                self.objectsString = objectsString;
                return self;
            });
        }
    },

    /**
     * Initializes the Template with Objects and a DocumentFragment to be
     * used as the body of the document.
     *
     * @function
     * @param {Object} objects A JSON'able representation of the objects of the
     *                         template.
     * @param {DocumentFragment} html The HTML string to be used as the body.
     * @param {require} _require The require function used to load modules when
     *                           a template is instantiated.
     * @returns {Promise} A promise for the proper initialization of the
     *                    template.
     */
    initWithObjectsAndDocumentFragment: {
        value: function (objects, documentFragment, _require) {
            this._require = _require;
            this.document = this.createHtmlDocumentWithHtml("");
            this.document.body.appendChild(
                this.document.importNode(documentFragment, true)
            );
            this.setObjects(objects);

            return this;
        }
    },

    /**
     * Initializes the Template with the HTML document at the module id.
     *
     * @function
     * @param {string} moduleId The module id of the HTML page to load.
     * @param {require} _require The require function used to load modules when
     *                           a template is instantiated.
     * @returns {Promise} A promise for the proper initialization of the
     *                    template.
     */
    initWithModuleId: {
        value: function (moduleId, _require) {
            var self = this;

            this._require = _require;

            return this.createHtmlDocumentWithModuleId(moduleId, _require)
            .then(function (_document) {
                var baseUrl = _require(moduleId).directory;

                self.document = _document;
                self.setBaseUrl(baseUrl);

                return self.getObjectsString(_document)
                .then(function (objectsString) {
                    self.objectsString = objectsString;

                    return self;
                });
            });
        }
    },

    clone: {
        value: function () {
            var clonedTemplate = new Template();

            clonedTemplate._require = this._require;
            clonedTemplate._baseUrl = this._baseUrl;
            clonedTemplate.setDocument(this.document);
            clonedTemplate.objectsString = this.objectsString;
            clonedTemplate._instances = Object.clone(this._instances, 1);

            return clonedTemplate;
        }
    },

    instantiate: {
        value: function (targetDocument) {
            return this.instantiateWithInstances(null, targetDocument);
        }
    },

    /**
     * @param instances {Object} The instances to use in the serialization
     *        section of the template, when given they will be used instead of
     *        creating a new object. It's dictionary where the keys are the
     *        labels and the values the instances.
     * @param targetDocument {Document} The document used to create the markup
     *        resultant of the instantiation.
     */
    instantiateWithInstances: {
        value: function (instances, targetDocument) {
            var self = this,
                fragment,
                part = new DocumentPart(),
                templateObjects,
                templateParameters;

            instances = instances || this._instances;
            fragment = this._createMarkupDocumentFragment(targetDocument);
            templateParameters = this._getParameters(fragment);

            part.initWithTemplateAndFragment(this, fragment);
            part.startActingAsTopComponent();
            part.parameters = templateParameters;

            templateObjects = this._createTemplateObjects(instances);

            return this._instantiateObjects(templateObjects, fragment)
            .then(function (objects) {
                var resources = self.getResources();

                if (!resources.resourcesLoaded() &amp;&amp; resources.hasResources()) {
                    // Start preloading the resources as soon as possible, no
                    // need to wait for them as the draw cycle will take care
                    // of that when loading the stylesheets into the document.
                    resources.loadResources(targetDocument);
                }

                part.objects = objects;
                self._invokeDelegates(part, instances);
                part.stopActingAsTopComponent();
                
                return part;
            });
        }
    },

    _objectsInstantiationOptimized: {
        value: false
    },
    _optimizeObjectsInstantiationPromise: {
        value: null
    },
    /**
     * @returns {undefined|Promise} A promise if there are objects to optimize,
     *         nothing otherwise.
     */
    _optimizeObjectsInstantiation: {
        value: function () {
            var self = this,
                promise;

            if (!this._objectsInstantiationOptimized) {
                if (!this._optimizeObjectsInstantiationPromise) {
                    promise = this._deserializer.preloadModules();

                    if (promise) {
                        this._optimizeObjectsInstantiationPromise = promise
                        .then(function () {
                            self._objectsInstantiationOptimized = true;
                        });
                    } else {
                        this._objectsInstantiationOptimized = true;
                    }
                }

                return this._optimizeObjectsInstantiationPromise;
            }
        }
    },

    setBaseUrl: {
        value: function (baseUrl) {
            this._baseUrl = baseUrl;
        }
    },

    getBaseUrl: {
        value: function () {
            return this._baseUrl;
        }
    },

    getResources: {
        value: function () {
            var resources = this._resources;

            if (!resources) {
                resources = this._resources = new exports.TemplateResources();
                resources.initWithTemplate(this);
            }

            return resources;
        }
    },

    /**
     * Creates the object instances to be passed to the deserialization.
     * It takes instances and augments it with "application" and "template".
     *
     * @param {Object} instances The instances object.
     * @returns {Object} The object with instances and application and template.
     */
    _createTemplateObjects: {
        value: function (instances) {
            var templateObjects = Object.create(instances || null);

            if (typeof defaultApplication === "undefined") {
                defaultApplication = require("./application").application;
            }

            templateObjects.application = defaultApplication;
            templateObjects.template = this;

            return templateObjects;
        }
    },

    _instantiateObjects: {
        value: function (instances, fragment) {
            var deserializer = this._deserializer,
                optimizationPromise;

            if (Promise.is(deserializer)) {
                return deserializer; // Promise return (error raised while deserializing)
            }

            optimizationPromise = this._optimizeObjectsInstantiation();

            if (optimizationPromise) {
                return optimizationPromise.then(function () {
                    return deserializer.deserialize(instances, fragment);
                });
            } else {
                return deserializer.deserialize(instances, fragment);
            }
        }
    },

    _createMarkupDocumentFragment: {
        value: function (targetDocument) {
            var fragment = targetDocument.createDocumentFragment(),
                nodes = this.document.body.childNodes;

            for (var i = 0, ii = nodes.length; i &lt; ii; i++) {
                fragment.appendChild(
                    targetDocument.importNode(nodes[i], true)
                );
            }

            return fragment;
        }
    },

    getParameterName: {
        value: function (element) {
            return element.getAttribute(this.PARAM_ATTRIBUTE);
        }
    },

    getParameters: {
        value: function () {
            return this._getParameters(this.document.body);
        }
    },

    _getParameters: {
        value: function (rootElement) {
            var elements = rootElement.querySelectorAll("*[" + this.PARAM_ATTRIBUTE + "]"),
                elementsCount = elements.length,
                element,
                parameterName,
                parameters = {};

            for (var i = 0; i &lt; elementsCount; i++) {
                element = elements[i];
                parameterName = this.getParameterName(element);

                if (parameterName in parameters) {
                    throw new Error('The parameter "' + parameterName + '" is' +
                        ' declared more than once in ' + this.getBaseUrl() +
                        '.');
                }

                parameters[parameterName] = element;
            }

            return parameters;
        }
    },

    hasParameters: {
        value: function () {
            return !!this.document.querySelector("*[" + this.PARAM_ATTRIBUTE + "]");
        }
    },

    _invokeDelegates: {
        value: function (documentPart, instances) {
            var objects = documentPart.objects,
                object,
                owner = objects.owner || instances &amp;&amp; instances.owner,
                objectOwner,
                objectLabel;

            /* jshint forin: true */
            for (var label in objects) {
            /* jshint forin: false */

                // Don't call delegate methods on objects that were passed to
                // the instantiation.
                if (instances &amp;&amp; label in instances) {
                    continue;
                }

                object = objects[label];
                // getObjectOwner will take into account metadata that might
                // have been set for this object. Objects in the serialization
                // of the template might have different owners. This is true
                // when an object in the serialization is the result of a
                // data-param that was expanded using arguments from an external
                // template.
                objectOwner = this._getObjectOwner(label, owner);
                objectLabel = this._getObjectLabel(label);

                if (object) {
                    if (typeof object._deserializedFromTemplate === "function") {
                        object._deserializedFromTemplate(objectOwner, objectLabel, documentPart);
                    }
                    if (typeof object.deserializedFromTemplate === "function") {
                        object.deserializedFromTemplate(objectOwner, objectLabel, documentPart);
                    }
                }
            }

            if (owner) {
                var serialization = this.getSerialization();

                // Don't call delegate methods on external objects
                if (!serialization.isExternalObject("owner")) {
                    if (typeof owner._templateDidLoad === "function") {
                        owner._templateDidLoad(documentPart);
                    }
                    if (typeof owner.templateDidLoad === "function") {
                        owner.templateDidLoad(documentPart);
                    }
                }
            }
        }
    },

    /**
     * Sets the instances to use when instantiating the objects of the template.
     * These instances will always be used when instantiating the template
     * unless a different set of instances is passed in
     * instantiateWithInstances().
     *
     * @function
     * @param {Object} instances The objects' instances.
     */
    setInstances: {
        value: function (instances) {
            this._instances = instances;
        }
    },

    getInstances: {
        value: function () {
            return this._instances;
        }
    },

    setObjects: {
        value: function (objects) {
            // TODO: use Serializer.formatSerialization(object|string)
            this.objectsString = JSON.stringify(objects, null, 4);
        }
    },

    /**
     * Add metadata to specific objects of the serialization.
     *
     * @param {string} label The label of the object in the serialization.
     * @param {Require} _require The require function to be used when loading
     *        the module.
     * @param {string} effectiveLabel An alternative label to be given to the
     *        object.
     * @param {Object} owner The owner object to be given to the object.
     */
    setObjectMetadata: {
        value: function (label, _require, effectiveLabel, owner) {
            var metadata = this._metadata;

            if (!metadata) {
                this._metadata = metadata = Object.create(null);
            }

            metadata[label] = {
                "require": _require,
                "label": effectiveLabel,
                "owner": owner
            };

            // Invalidate the deserializer cache since we need to setup new
            // requires.
            this.__deserializer = null;
        }
    },

    getObjectMetadata: {
        value: function (label) {
            var metadata = this._metadata;

            if (metadata &amp;&amp; label in metadata) {
                return metadata[label];
            } else {
                return {
                    "require": this._require,
                    "label": label
                };
            }
        }
    },

    _getObjectOwner: {
        value: function (label, defaultOwner) {
            var objectOwner,
                metadata = this._metadata;

            if (metadata &amp;&amp; label in metadata) {
                objectOwner = metadata[label].owner;
            } else {
                objectOwner = defaultOwner;
            }

            return objectOwner;
        }
    },

    _getObjectLabel: {
        value: function (label) {
            var objectLabel,
                metadata = this._metadata;

            if (metadata &amp;&amp; label in metadata) {
                objectLabel = metadata[label].label;
            } else {
                objectLabel = label;
            }

            return objectLabel;
        }
    },

    /**
     * Uses the document markup as the base of the template markup.
     *
     * @function
     * @param {HTMLDocument} doc The document.
     * @returns {Promise} A promise for the proper initialization of the
     *                    document.
     */
    setDocument: {
        value: function(_document) {
            this.document = this.cloneHtmlDocument(_document);

            this.clearTemplateFromElementContentsCache();
        }
    },

    /**
     * Searches for objects in the document.
     * The objects string can live as an inline script in the document or as an
     * external resource that needs to be loaded.
     *
     * @function
     * @param {HTMLDocument} doc The document with the objects string.
     * @returns {Promise} A promise for the objects string, null if not
     *                    found.
     */
    getObjectsString: {
        value: function (doc) {
            var objectsString;

            objectsString = this.getInlineObjectsString(doc);

            if (objectsString === null) {
                return this.getExternalObjectsString(doc);
            } else {
                return Promise.resolve(objectsString);
            }
        }
    },

    /**
     * Searches for an inline objects string in a document and returns it if
     * found.
     *
     * @function
     * @param {HTMLDocument} doc The document with the objects string.
     * @returns {?String} The objects string or null if not found.
     */
    getInlineObjectsString: {
        value: function (doc) {
            var selector = "script[type='" + this._SERIALIZATION_SCRIPT_TYPE + "']",
                script = doc.querySelector(selector);

            if (script) {
                return script.textContent;
            } else {
                return null;
            }
        }
    },

    /**
     * Searches for an external objects file in a document and returns its
     * contents if found.
     *
     * @function
     * @param {string} doc The document to search.
     * @returns {Promise} A promise to the contents of the objects file or null
     *                    if none found.
     */
    getExternalObjectsString: {
        value: function (doc) {
            var link = doc.querySelector('link[rel="serialization"]'),
                deferred;

            if (link) {
                // TODO use core/request
                deferred = new Promise(function(resolve, reject) {
                    var req = new XMLHttpRequest();
                    var url = link.getAttribute("href");
                    req.open("GET", url);
                    req.addEventListener("load", function(event) {
                        var req = event.target;
                        if (req.status === 200) {
                            resolve(req.responseText);
                        } else {
                            reject(
                                new Error("Unable to retrive '" + url + "', code status: " + req.status)
                            );
                        }
                    }, false);
                    req.addEventListener("error", function(event) {
                        reject(
                            new Error("Unable to retrive '" + url + "' with error: " + event.error + ".")
                        );
                    }, false);
                    req.send();

                });

                return deferred;
            } else {
                return Promise.resolve(null);
            }
        }
    },

    createHtmlDocumentWithHtml: {
        value: function (html, baseURI) {
            var htmlDocument = document.implementation.createHTMLDocument("");
            if (html) {
                htmlDocument.documentElement.innerHTML = html;
                if (baseURI) {
                    this.normalizeRelativeUrls(htmlDocument, baseURI);
                }
            }
            return htmlDocument;
        }
    },

    cloneHtmlDocument: {
        value: function (htmlDocument) {
            /*
             * Temporary fix for the function createHtmlDocumentWithHtml.
             *
             * Indeed, innerHTML does not allow us to have a document with some invalid HTML code,
             * that could belong to an iteration's template for example.
             *
             * Such as:
             *  &lt;body>&lt;tr>&lt;/tr>&lt;/body> --> &lt;body>&lt;/body>
             *
             * Todo Plus, The DOMImplementation.createHTMLDocument() method has a parameter optional `title`
             * https://dom.spec.whatwg.org/#domimplementation
             *
             * Removing it will improve the performance, but it is not optional for IE.
             *
             */
            var clonedDocument = document.implementation.createHTMLDocument(""),
                baseURI = htmlDocument.baseURI || htmlDocument.URL;

            clonedDocument.replaceChild(
                clonedDocument.importNode(htmlDocument.documentElement, true),
                clonedDocument.documentElement
            );

            this.normalizeRelativeUrls(clonedDocument, baseURI);

            return clonedDocument;
        }
    },

    createHtmlDocumentWithModuleId: {
        value: function (moduleId, _require) {
            var self = this;

            if (typeof _require !== "function") {
                return Promise.reject(
                    new Error("Missing 'require' function to load module '" + moduleId + "'.")
                );
            }

            return _require.async(moduleId).then(function (exports) {
                return self.createHtmlDocumentWithHtml(exports.content, exports.directory);
            });
        }
    },

    /**
     * Removes all artifacts related to objects string
     */
    _removeObjects: {
        value: function (doc) {
            var selector = "script[type='" + this._SERIALIZATION_SCRIPT_TYPE + "'], link[rel='serialization']";

            Array.prototype.forEach.call(
                doc.querySelectorAll(selector),
                function (element) {
                    element.parentNode.removeChild(element);
                }
            );
        }
    },

    _addObjects: {
        value: function (doc, objectsString) {
            if (objectsString) {
                var script = doc.createElement("script");

                script.setAttribute("type", this._SERIALIZATION_SCRIPT_TYPE);
                script.textContent = JSON.stringify(JSON.parse(objectsString), null, 4);
                doc.head.appendChild(script);
            }
        }
    },

    _templateFromElementContentsCache: {
        value: null
    },
    clearTemplateFromElementContentsCache: {
        value: function () {
            this._templateFromElementContentsCache = null;
        }
    },

    createTemplateFromElementContents: {
        value: function (elementId) {
            var element,
                template,
                range,
                cache = this._templateFromElementContentsCache;

            if (!cache) {
                cache = Object.create(null);
                this._templateFromElementContentsCache = cache;
            }

            if (elementId in cache) {
                // We always return an extension of the cached object, this
                // is because the template can be assigned with instances.
                // An alternate idea would be to clone it but it's much more
                // expensive.
                return Object.create(cache[elementId]);
            }

            element = this.getElementById(elementId);

            // Clone the element contents
            range = this.document.createRange();
            range.selectNodeContents(element);

            // Create the new template with the extracted serialization and
            // markup.
            template = this.createTemplateFromRange(range);

            cache[elementId] = template;

            // We always return an extension of the cached object, this
            // is because the template is mutable.
            // An alternate idea would be to clone it but it's much more
            // expensive.
            return Object.create(template);
        }
    },

    createTemplateFromElement: {
        value: function (elementId) {
            var element,
                range;

            element = this.getElementById(elementId);

            // Clone the element contents
            range = this.document.createRange();
            range.selectNode(element);

            return this.createTemplateFromRange(range);
        }
    },

    createTemplateFromRange: {
        value: function (range) {
            var fragment,
                elementIds,
                labels,
                template,
                serialization = new Serialization(),
                extractedSerialization;

            fragment = range.cloneContents();

            // Find all elements of interest to the serialization.
            elementIds = this._getChildrenElementIds(fragment);

            // Create a new serialization with the components found in the
            // element.
            serialization.initWithString(this.objectsString);
            labels = serialization.getSerializationLabelsWithElements(
                elementIds);
            extractedSerialization = serialization.extractSerialization(
                labels, ["owner"]);

            // Create the new template with the extracted serialization and
            // markup.
            template = new Template();
            template.initWithObjectsAndDocumentFragment(
                null, fragment, this._require);
            template.objectsString = extractedSerialization
                .getSerializationString();
            template._resources = this.getResources();

            return template;
        }
    },

    // TODO: should this be on Serialization?
    _createSerializationWithElementIds: {
        value: function (elementIds) {
            var serialization = new Serialization(),
                labels,
                extractedSerialization;

            serialization.initWithString(this.objectsString);
            labels = serialization.getSerializationLabelsWithElements(
                elementIds);

            extractedSerialization = serialization.extractSerialization(
                labels, ["owner"]);

            return extractedSerialization;
        }
    },

    /**
     * @param {TemplateArgumentProvider} templateArgumentProvider An object that
     *        implements the interface needed to provide the arguments to the
     *        parameters.
     * @returns {Object} A dictionary with four properties representing the
     *          objects and elements that were imported into the template:
     *          - labels: the labels of the objects added from template
     *                    argument.
     *          - labelsCollisions: a dictionary of label collisions in the form
     *                              of {oldLabel: newLabel}.
     *          - elementIds: the element ids of the markup imported from
     *                        template argument.
     *          - elementIdsCollisions: a dictionary of element id collisions in
     *                                  the form of {oldElementId: newElementId}
     *
     */
    expandParameters: {
        value: function (templateArgumentProvider) {
            var parameterElements,
                argumentsElementIds = [],
                collisionTable,
                argumentElementsCollisionTable = {},
                objectsCollisionTable,
                parameterElement,
                argumentElement,
                serialization = this.getSerialization(),
                argumentsSerialization,
                willMergeObjectWithLabel,
                result = {};

            parameterElements = this.getParameters();

            // Expand elements.
            for (var parameterName in parameterElements) {
                if (parameterElements.hasOwnProperty(parameterName)) {
                    parameterElement = parameterElements[parameterName];
                    argumentElement = templateArgumentProvider.getTemplateArgumentElement(
                        parameterName);

                    // Store all element ids of the argument, we need to create
                    // a serialization with the components that point to them.
                    argumentsElementIds.push.apply(argumentsElementIds,
                        this._getElementIds(argumentElement)
                    );

                    // Replace the parameter with the argument and save the
                    // element ids collision table because we need to correct the
                    // serialization that is created from the stored element ids.
                    collisionTable = this.replaceNode(argumentElement, parameterElement);
                    if (collisionTable) {
                        /* jshint forin: true */
                        for (var key in collisionTable) {
                        /* jshint forin: false */
                            argumentElementsCollisionTable[key] = collisionTable[key];
                        }
                    }   
                }
            }
            result.elementIds = argumentsElementIds;
            result.elementIdsCollisions = argumentElementsCollisionTable;

            // Expand objects.
            argumentsSerialization = templateArgumentProvider
                .getTemplateArgumentSerialization(argumentsElementIds);

            argumentsSerialization.renameElementReferences(
                argumentElementsCollisionTable);

            // When merging the serializations we need to resolve any template
            // property alias that comes from the arguments, for instance, the
            // argument could be referring to @table:cell in its scope when in
            // this scope (the serialization1) it is aliased to
            // @repetition:iteration. To do this we ask the argument provider
            // to resolve the template property for us.
            // This approach works because the arguments serialization is
            // created assuming that template properties are just like any other
            // label and are considered external objects.
            willMergeObjectWithLabel = function (label) {
                if (label.indexOf(":") > 0) {
                    return templateArgumentProvider
                        .resolveTemplateArgumentTemplateProperty(label);
                }
            };

            objectsCollisionTable = serialization.mergeSerialization(
                argumentsSerialization, {
                    willMergeObjectWithLabel: willMergeObjectWithLabel
                });
            this.objectsString = serialization.getSerializationString();

            result.labels = argumentsSerialization.getSerializationLabels();
            result.labelsCollisions = objectsCollisionTable;

            return result;
        }
    },

    /**
     * Takes a foreign node and generate new ids for all element ids that
     * already exist in the current template.
     */
    _resolveElementIdCollisions: {
        value: function (node, labeler) {
            var collisionTable,
                nodeElements,
                elementId,
                elementIds,
                element,
                newId;

            labeler = labeler || new MontageLabeler();
            // Set up the labeler with the current element ids.
            elementIds = this.getElementIds();
            for (var i = 0; (elementId = elementIds[i]); i++) {
                labeler.addLabel(elementId);
            }

            // Resolve element ids collisions.
            nodeElements = this._getElements(node);
            for (elementId in nodeElements) {
                if (this.getElementById(elementId)) {
                    element = nodeElements[elementId];
                    newId = labeler.generateLabel(labeler.getLabelBaseName(elementId));
                    this.setElementId(element, newId);
                    if (!collisionTable) {
                        collisionTable = Object.create(null);
                    }
                    collisionTable[elementId] = newId;
                }
            }

            return collisionTable;
        }
    },

    replaceNode: {
        value: function (newNode, oldNode, labeler) {
            var collisionTable;

            collisionTable = this._resolveElementIdCollisions(newNode, labeler);
            this.normalizeRelativeUrls(newNode, this.getBaseUrl());
            oldNode.parentNode.replaceChild(newNode, oldNode);

            return collisionTable;
        }
    },

    insertNodeBefore: {
        value: function (node, reference, labeler) {
            var collisionTable;

            collisionTable = this._resolveElementIdCollisions(node, labeler);
            this.normalizeRelativeUrls(node, this.getBaseUrl());
            reference.parentNode.insertBefore(node, reference);

            return collisionTable;
        }
    },

    appendNode: {
        value: function (node, parentNode, labeler) {
            var collisionTable;

            collisionTable = this._resolveElementIdCollisions(node, labeler);
            this.normalizeRelativeUrls(node, this.getBaseUrl());
            parentNode.appendChild(node);

            return collisionTable;
        }
    },

    getElementId: {
        value: function (element) {
            if (element.getAttribute) {
                return element.getAttribute(this._ELEMENT_ID_ATTRIBUTE);
            }
        }
    },

    setElementId: {
        value: function (element, elementId) {
            element.setAttribute(this._ELEMENT_ID_ATTRIBUTE, elementId);
        }
    },

    getElementIds: {
        value: function () {
            return this._getElementIds(this.document.body);
        }
    },

    _getElements: {
        value: function (rootNode) {
            var selector = "*[" + this._ELEMENT_ID_ATTRIBUTE + "]",
                elements,
                result = {},
                elementId;

            elements = rootNode.querySelectorAll(selector);

            for (var i = 0, element; (element = elements[i]); i++) {
                elementId = this.getElementId(element);
                result[elementId] = element;
            }

            elementId = this.getElementId(rootNode);
            if (elementId) {
                result[elementId] = rootNode;
            }

            return result;
        }
    },

    _getChildrenElementIds: {
        value: function (rootNode) {
            // XPath might do a better job here...should test.
            var selector = "*[" + this._ELEMENT_ID_ATTRIBUTE + "]",
                elements,
                elementIds = [];

            elements = rootNode.querySelectorAll(selector);

            for (var i = 0, element; (element = elements[i]); i++) {
                elementIds.push(this.getElementId(element));
            }

            return elementIds;
        }
    },

    _getElementIds: {
        value: function (rootNode) {
            var elementIds = this._getChildrenElementIds(rootNode),
                elementId;

            elementId = this.getElementId(rootNode);
            if (elementId) {
                elementIds.push(elementId);
            }

            return elementIds;
        }
    },

    getElementById: {
        value: function (elementId) {
            var selector = "*[" + this._ELEMENT_ID_ATTRIBUTE + "='" + elementId + "']";

            return this.document.querySelector(selector);
        }
    },

    html: {
        get: function () {
            var _document = this.document;

            this._removeObjects(_document);
            this._addObjects(_document, this.objectsString);

            return this._getDoctypeString(_document.doctype) + "\n" +
                _document.documentElement.outerHTML;
        }
    },

    _getDoctypeString: {
        value: function (doctype) {
            return "&lt;!DOCTYPE " +
                doctype.name +
                (doctype.publicId ? ' PUBLIC "' + doctype.publicId + '"' : '') +
                (!doctype.publicId &amp;&amp; doctype.systemId ? ' SYSTEM' : '') +
                (doctype.systemId ? ' "' + doctype.systemId + '"' : '') +
                '>';
        }
    },

    normalizeRelativeUrls: {
        value: function (parentNode, baseUrl) {
            // Resolve component's images relative URLs if we have a valid baseUrl
            if (typeof baseUrl === "string" &amp;&amp; baseUrl !== "" &amp;&amp; baseUrl !== 'about:blank') {
                // We are only looking for DOM and SVG image elements
                var XLINK_NS = 'http://www.w3.org/1999/xlink',          // Namespace for SVG's xlink
                    absoluteUrlRegExp = /^[\w\-]+:|^\//,                // Check for "&lt;protocol>:", "/" and "//",
                    nodes = Template._NORMALIZED_TAG_NAMES.indexOf(parentNode.tagName) !== -1 ?
                        [parentNode] : parentNode.querySelectorAll(Template._NORMALIZED_TAG_NAMES_SELECTOR);

                for (var i = 0, ii = nodes.length; i &lt; ii; i++) {
                    var node = nodes[i],
                        url;

                    if (node.tagName === 'image') {
                        // SVG image
                        url = node.getAttributeNS(XLINK_NS, 'href');
                        if (!absoluteUrlRegExp.test(url)) {
                            node.setAttributeNS(XLINK_NS, 'href', URL.resolve(baseUrl, url));
                        }
                    } else {
                        // DOM image
                        if (node.hasAttribute("src")) {
                            url = node.getAttribute('src');
                            if (url !== "" &amp;&amp; !absoluteUrlRegExp.test(url)) {
                                node.setAttribute('src', URL.resolve(baseUrl, url));
                            }
                        } else if (node.hasAttribute("href")) {
                            // Stylesheets
                            url = node.getAttribute('href');
                            if (url !== "" &amp;&amp; !absoluteUrlRegExp.test(url)) {
                                node.setAttribute('href', URL.resolve(baseUrl, url));
                            }
                        }
                    }
                }
            }

        }
    },

    replaceContentsWithTemplate: {
        value: function (template) {
            this._require = template._require;
            this._baseUrl = template._baseUrl;
            this._document = template._document;
            this.objectsString = template.objectsString;
            this._instances = template._instances;
            this._templateFromElementContentsCache = template._templateFromElementContentsCache;
            this._metadata = template._metadata;
        }
    },

    /**
     * Refresh the contents of the template when its dirty.
     */
    refresh: {
        value: function () {
            if (this.isDirty) {
                if (this.refresher &amp;&amp;
                    typeof this.refresher.refreshTemplate === "function") {
                    this.refresher.refreshTemplate(this);
                    this.isDirty = false;
                } else {
                    console.warn("Not able to refresh without a refresher.refreshTemplate.");
                }
            }
        }
    }

}, {

    _templateCache: {
        value: {
            moduleId: Object.create(null)
        }
    },
    _getTemplateCacheKey: {
        value: function (moduleId, _require) {
            // Transforms relative module ids into absolute module ids
            moduleId = _require.resolve(moduleId);
            return _require.location + "#" + moduleId;
        }
    },
    getTemplateWithModuleId: {
        value: function (moduleId, _require) {
            var cacheKey,
                template;

            cacheKey = this._getTemplateCacheKey(moduleId, _require);
            template = this._templateCache.moduleId[cacheKey];

            if (!template) {
                template = new Template()
                .initWithModuleId(moduleId, _require);

                this._templateCache.moduleId[cacheKey] = template;
            }

            return template;
        }
    },

    _NORMALIZED_TAG_NAMES: {
        value: ["IMG", "image", "IFRAME", "link","script"]
    },

    __NORMALIZED_TAG_NAMES_SELECTOR: {
        value: null
    },

    _NORMALIZED_TAG_NAMES_SELECTOR: {
        get: function () {
            if (!this.__NORMALIZED_TAG_NAMES_SELECTOR) {
                this.__NORMALIZED_TAG_NAMES_SELECTOR = this._NORMALIZED_TAG_NAMES.join(",");
            }
            return this.__NORMALIZED_TAG_NAMES_SELECTOR;
        }
    }

});

/**
 * @class TemplateResources
 * @extends Montage
 */
var TemplateResources = Montage.specialize( /** @lends TemplateResources# */ {
    _resources: {value: null},
    _resourcesLoaded: {value: false},
    template: {value: null},
    rootUrl: {value: ""},

    constructor: {
        value: function TemplateResources() {
            this._resources = Object.create(null);
        }
    },

    initWithTemplate: {
        value: function (template) {
            this.template = template;
        }
    },

    hasResources: {
        value: function () {
            return this.getStyles().length > 0 || this.getScripts().length > 0;
        }
    },

    resourcesLoaded: {
        value: function () {
            return this._resourcesLoaded;
        }
    },

    loadResources: {
        value: function (targetDocument) {
            this._resourcesLoaded = true;

            return Promise.all([
                this.loadScripts(targetDocument),
                this.loadStyles(targetDocument)
            ]);
        }
    },

    getScripts: {
        value: function () {
            var scripts = this._resources.scripts,
                script,
                template,
                templateScripts;

            if (!scripts) {
                template = this.template;

                scripts = this._resources.scripts = [];
                templateScripts = template.document.querySelectorAll("script");

                for (var i = 0, ii = templateScripts.length; i &lt; ii; i++) {
                    script = templateScripts[i];

                    if (script.type !== this.template._SERIALIZATION_SCRIPT_TYPE) {
                        scripts.push(script);
                    }
                }
            }

            return scripts;
        }
    },

    loadScripts: {
        value: function (targetDocument) {
            var scripts = this.getScripts(),
                ii = scripts.length;

            if (ii) {
                var promises = [];

                for (var i = 0; i &lt; ii; i++) {
                    promises.push(
                        this.loadScript(scripts[i], targetDocument)
                    );
                }

                return Promise.all(promises);
            }

            return Promise.resolve();
        }
    },

    loadScript: {
        value: function (script, targetDocument) {
            var documentResources,
                newScript;

            documentResources = DocumentResources.getInstanceForDocument(targetDocument);
            // Firefox isn't able to load a script that we reuse, we need to
            // create a new one :(.
            //newScript = targetDocument.importNode(script);
            newScript = this._cloneScriptElement(script, targetDocument);

            return documentResources.addScript(newScript);
        }
    },

    _cloneScriptElement: {
        value: function (scriptTemplate, _document) {
            var script = _document.createElement("script"),
                attributes = scriptTemplate.attributes,
                attribute;

            for (var i = 0, ii = attributes.length; i &lt; ii; i++) {
                attribute = attributes[i];

                script.setAttribute(attribute.name, attribute.value);
            }
            script.textContent = scriptTemplate.textContent;

            return script;
        }
    },

    getStyles: {
        value: function () {
            var styles = this._resources.styles,
                template,
                templateStyles,
                styleSelector;

            if (!styles) {
                styleSelector = 'link[rel="stylesheet"], style';
                template = this.template;

                templateStyles = template.document.querySelectorAll(styleSelector);

                styles = Array.prototype.slice.call(templateStyles, 0);
                this._resources.styles = styles;
            }

            return styles;
        }
    },

    loadStyles: {
        value: function (targetDocument) {
            var promises = [],
                styles;

            styles = this.getStyles();

            for (var i = 0, ii = styles.length; i &lt; ii; i++) {
                promises.push(
                    this.loadStyle(styles[i], targetDocument)
                );
            }

            return Promise.all(promises);
        }
    },

    loadStyle: {
        value: function (element, targetDocument) {
            var url,
                documentResources;

            url = element.getAttribute("href");

            if (url) {
                documentResources = DocumentResources.getInstanceForDocument(targetDocument);
                return documentResources.preloadResource(url);
            } else {
                return Promise.resolve();
            }
        }
    },

    createStylesForDocument: {
        value: function (targetDocument) {
            var styles = this.getStyles(),
                newStyle,
                stylesForDocument = [];

            for (var i = 0, style; (style = styles[i]); i++) {
                newStyle = targetDocument.importNode(style, true);
                stylesForDocument.push(newStyle);
            }

            return stylesForDocument;
        }
    }
});

// Used to create a DocumentPart from a document without a Template
function instantiateDocument(_document, _require, instances) {
    var template = new Template(),
        html = _document.documentElement.outerHTML,
        part = new DocumentPart(),
        clonedDocument,
        templateObjects,
        rootElement = _document.documentElement;

    // Setup a template just like we'd do for a document in a template
    clonedDocument = template.createHtmlDocumentWithHtml(html, _document.location.href);

    return template.initWithDocument(clonedDocument, _require)
    .then(function () {
        template.setBaseUrl(_document.location.href);
        // Instantiate it using the document given since we don't want to clone
        // the document markup
        templateObjects = template._createTemplateObjects(instances);
        part.initWithTemplateAndFragment(template);

        return template._instantiateObjects(templateObjects, rootElement)
        .then(function (objects) {
            part.objects = objects;
            template._invokeDelegates(part);

            return part;
        });
    });
}

var TemplateArgumentProvider = Montage.specialize({
    /**
     * This function asks the provider to return the element that corresponds
     * to the argument with the same name. This element will be used to replace
     * the corresponding element with data-param of the template being expanded.
     * @param argumentName
     * @private
     */
    getTemplateArgumentElement: {
        value: Function.noop
    },

    /**
     * This function asks the provider to return the serialization components
     * that refer to the given element ids.
     * The serialization returned will be merged with the serialization of the
     * template being expanded.
     * @param elementIds
     * @private
     */
    getTemplateArgumentSerialization: {
        value: Function.noop
    },

    /**
     * This function asks the provider to resolve a template property that was
     * found in the argument serialization. The template property could be an
     * alias that only the provider knows how to resolve because they have
     * access to the template where the argument comes from and where the
     * aliases are defined in the serialization block (e.g: ":cell": {alias:
     * "@repetition:iteration"}).
     * @param templatePropertyLabel
     * @private
     */
    resolveTemplateArgumentTemplateProperty: {
        value: Function.noop
    }
});

exports.Template = Template;
exports.TemplateArgumentProvider = TemplateArgumentProvider;
exports.TemplateResources = TemplateResources;
exports.instantiateDocument = instantiateDocument;
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="module-_._foo.reel_.html">"./foo.reel"</a></li><li><a href="module-_montage_ui_condition.reel_.html">"montage/ui/condition.reel"</a></li><li><a href="module-_montage_ui_flow.reel_.html">"montage/ui/flow.reel"</a></li><li><a href="module-_montage_ui_input-radio.reel_.html">"montage/ui/input-radio.reel"</a></li><li><a href="module-_montage_ui_label.reel_.html">"montage/ui/label.reel"</a></li><li><a href="module-_montage_ui_loader.reel_.html">"montage/ui/loader.reel"</a></li><li><a href="module-_montage_ui_native_button.reel_.html">"montage/ui/native/button.reel"</a></li><li><a href="module-_montage_ui_native_checkbox.reel_.html">"montage/ui/native/checkbox.reel"</a></li><li><a href="module-_montage_ui_native_image.reel_.html">"montage/ui/native/image.reel"</a></li><li><a href="module-_montage_ui_native_input-date.reel_.html">"montage/ui/native/input-date.reel"</a></li><li><a href="module-_montage_ui_native_input-number.reel_.html">"montage/ui/native/input-number.reel"</a></li><li><a href="module-_montage_ui_native_input-range.reel_.html">"montage/ui/native/input-range.reel"</a></li><li><a href="module-_montage_ui_native_input-text.reel_.html">"montage/ui/native/input-text.reel"</a></li><li><a href="module-_montage_ui_native_progress.reel_.html">"montage/ui/native/progress.reel"</a></li><li><a href="module-_montage_ui_native_select.reel_.html">"montage/ui/native/select.reel"</a></li><li><a href="module-_montage_ui_native_textarea.reel_.html">"montage/ui/native/textarea.reel"</a></li><li><a href="module-_montage_ui_repetition.reel_.html">"montage/ui/repetition.reel"</a></li><li><a href="module-_montage_ui_segmented-bar.reel_.html">"montage/ui/segmented-bar.reel"</a></li><li><a href="module-_montage_ui_slot.reel_.html">"montage/ui/slot.reel"</a></li><li><a href="module-_montage_ui_substitution.reel_.html">"montage/ui/substitution.reel"</a></li><li><a href="module-_montage_ui_succession.reel_.html">"montage/ui/succession.reel"</a></li><li><a href="module-_montage_ui_text.reel_.html">"montage/ui/text.reel"</a></li><li><a href="module-_native_ui_anchor.reel_.html">"native/ui/anchor.reel"</a></li><li><a href="module-_ui_main.reel_.html">"ui/main.reel"</a></li><li><a href="module-_ui_modal-overlay.reel_.html">"ui/modal-overlay.reel"</a></li><li><a href="module-_ui_overlay.reel_.html">"ui/overlay.reel"</a></li><li><a href="module-_ui_segmented-bar.reel_segment.reel_.html">"ui/segmented-bar.reel/segment.reel"</a></li><li><a href="module-core_application.html">core/application</a></li><li><a href="module-montage_composer_composer.html">montage/composer/composer</a></li><li><a href="module-montage_composer_key-composer.html">montage/composer/key-composer</a></li><li><a href="module-montage_composer_press-composer.html">montage/composer/press-composer</a></li><li><a href="module-montage_composer_swipe-composer.html">montage/composer/swipe-composer</a></li><li><a href="module-montage_composer_translate-composer.html">montage/composer/translate-composer</a></li><li><a href="module-montage_core_bindings.html">montage/core/bindings</a></li><li><a href="module-montage_core_bitfield.html">montage/core/bitfield</a></li><li><a href="module-montage_core_converter_bytes-converter.html">montage/core/converter/bytes-converter</a></li><li><a href="module-montage_core_converter_camel-case-converter.html">montage/core/converter/camel-case-converter</a></li><li><a href="module-montage_core_converter_converter.html">montage/core/converter/converter</a></li><li><a href="module-montage_core_converter_currency-converter.html">montage/core/converter/currency-converter</a></li><li><a href="module-montage_core_converter_date-converter.html">montage/core/converter/date-converter</a></li><li><a href="module-montage_core_converter_invert-converter.html">montage/core/converter/invert-converter</a></li><li><a href="module-montage_core_converter_kebab-case-converter.html">montage/core/converter/kebab-case-converter</a></li><li><a href="module-montage_core_converter_lower-case-converter.html">montage/core/converter/lower-case-converter</a></li><li><a href="module-montage_core_converter_new-line-to-br-converter.html">montage/core/converter/new-line-to-br-converter</a></li><li><a href="module-montage_core_converter_number-converter.html">montage/core/converter/number-converter</a></li><li><a href="module-montage_core_converter_number-to-nearest-integer-converter.html">montage/core/converter/number-to-nearest-integer-converter</a></li><li><a href="module-montage_core_converter_snake-case-converter.html">montage/core/converter/snake-case-converter</a></li><li><a href="module-montage_core_converter_trim-converter.html">montage/core/converter/trim-converter</a></li><li><a href="module-montage_core_converter_upper-case-converter.html">montage/core/converter/upper-case-converter</a></li><li><a href="module-montage_core_core.html">montage/core/core</a></li><li><a href="module-montage_core_deprecate.html">montage/core/deprecate</a></li><li><a href="module-montage_core_dom.html">montage/core/dom</a></li><li><a href="module-montage_core_enum.html">montage/core/enum</a></li><li><a href="module-montage_core_event_action-event-listener.html">montage/core/event/action-event-listener</a></li><li><a href="module-montage_core_event_event-manager.html">montage/core/event/event-manager</a></li><li><a href="module-montage_core_event_key-manager.html">montage/core/event/key-manager</a></li><li><a href="module-montage_core_event_mutable-event.html">montage/core/event/mutable-event</a></li><li><a href="module-montage_core_exception.html">montage/core/exception</a></li><li><a href="module-montage_core_extras_date.html">montage/core/extras/date</a></li><li><a href="module-montage_core_extras_function.html">montage/core/extras/function</a></li><li><a href="module-montage_core_extras_object.html">montage/core/extras/object</a></li><li><a href="module-montage_core_extras_string.html">montage/core/extras/string</a></li><li><a href="module-montage_core_gate.html">montage/core/gate</a></li><li><a href="module-montage_core_geometry_cubic-bezier.html">montage/core/geometry/cubic-bezier</a></li><li><a href="module-montage_core_geometry_point.html">montage/core/geometry/point</a></li><li><a href="module-montage_core_localizer.html">montage/core/localizer</a></li><li><a href="module-montage_core_logger.html">montage/core/logger</a></li><li><a href="module-montage_core_meta_validation-rule.html">montage/core/meta/validation-rule</a></li><li><a href="module-montage_core_module-reference.html">montage/core/module-reference</a></li><li><a href="module-montage_core_object-controller.html">montage/core/object-controller</a></li><li><a href="module-montage_core_range-controller.html">montage/core/range-controller</a></li><li><a href="module-montage_core_serialization.html">montage/core/serialization</a></li><li><a href="module-montage_core_serialization_serializer_montage-serializer.html">montage/core/serialization/serializer/montage-serializer</a></li><li><a href="module-montage_core_shim_array.html">montage/core/shim/array</a></li><li><a href="module-montage_core_shim_object.html">montage/core/shim/object</a></li><li><a href="module-montage_core_shim_string.html">montage/core/shim/string</a></li><li><a href="module-montage_core_state-chart.html">montage/core/state-chart</a></li><li><a href="module-montage_core_undo-manager.html">montage/core/undo-manager</a></li><li><a href="module-montage_core_uuid.html">montage/core/uuid</a></li><li><a href="module-montage_data_object-property.html">montage/data/object-property</a></li><li><a href="module-montage_serialization_serialization.html">montage/serialization/serialization</a></li><li><a href="module-montage_ui_base_abstract-button.html">montage/ui/base/abstract-button</a></li><li><a href="module-montage_ui_base_abstract-control.html">montage/ui/base/abstract-control</a></li><li><a href="module-montage_ui_check-control.html">montage/ui/check-control</a></li><li><a href="module-montage_ui_component.html">montage/ui/component</a></li><li><a href="module-montage_ui_control.html">montage/ui/control</a></li><li><a href="module-montage_ui_controller_media-controller.html">montage/ui/controller/media-controller</a></li><li><a href="module-montage_ui_passage.html">montage/ui/passage</a></li><li><a href="module-montage_ui_text-input.html">montage/ui/text-input</a></li><li><a href="montage_ui_base_abstract-image.module_reel.html">reel</a></li><li><a href="montage_ui_base_abstract-select.module_reel.html">reel</a></li><li><a href="montage_ui_base_abstract-slider.module_reel.html">reel</a></li><li><a href="montage_ui_base_abstract-toggle-button.module_reel.html">reel</a></li><li><a href="montage_ui_base_abstract-toggle-switch.module_reel.html">reel</a></li><li><a href="montage_ui_base_abstract-video.module_reel.html">reel</a></li><li><a href="ui_alert.module_reel.html">reel</a></li><li><a href="ui_base_abstract-progress-bar.module_js.html">js</a></li><li><a href="ui_caption.module_reel.html">reel</a></li><li><a href="ui_draggable-square.module_reel.html">reel</a></li><li><a href="ui_list.module_reel.html">reel</a></li><li><a href="ui_main.module_reel.html">reel</a></li><li><a href="ui_montage-studio-loader.module_reel.html">reel</a></li><li><a href="ui_press-composer-layers.module_reel.html">reel</a></li><li><a href="ui_square.module_reel.html">reel</a></li><li><a href="ui_tree-list.module_reel.html">reel</a></li><li><a href="-_rotation-composer.module_reel.html">reel</a></li></ul><h3>Externals</h3><ul><li><a href="external-Array.html">Array</a></li><li><a href="external-Function.html">Function</a></li><li><a href="external-Object.html">Object</a></li><li><a href="external-RegExp.html">RegExp</a></li><li><a href="external-String.html">String</a></li></ul><h3>Classes</h3><ul><li><a href="AbstractCheckbox.html">AbstractCheckbox</a></li><li><a href="AbstractLink.html">AbstractLink</a></li><li><a href="AbstractNumberField.html">AbstractNumberField</a></li><li><a href="AbstractRadioButton.html">AbstractRadioButton</a></li><li><a href="AbstractTextArea.html">AbstractTextArea</a></li><li><a href="AbstractTextField.html">AbstractTextField</a></li><li><a href="Alias.html">Alias</a></li><li><a href="Authorization.html">Authorization</a></li><li><a href="AuthorizationManager.html">AuthorizationManager</a></li><li><a href="AuthorizationService.html">AuthorizationService</a></li><li><a href="BlueprintDataMapping.html">BlueprintDataMapping</a></li><li><a href="ConnectionDescriptor.html">ConnectionDescriptor</a></li><li><a href="DataIdentifier.html">DataIdentifier</a></li><li><a href="DataMapping.html">DataMapping</a></li><li><a href="DataObjectDescriptor.html">DataObjectDescriptor</a></li><li><a href="DataOperation.html">DataOperation</a></li><li><a href="DataOrdering.html">DataOrdering</a></li><li><a href="DataPropertyDescriptor.html">DataPropertyDescriptor</a></li><li><a href="DataProvider.html">DataProvider</a></li><li><a href="DataQuery.html">DataQuery</a></li><li><a href="DataSelector.html">DataSelector</a></li><li><a href="DataService.html">DataService</a></li><li><a href="DataStream.html">DataStream</a></li><li><a href="DerivedDescriptor.html">DerivedDescriptor</a></li><li><a href="ElementReference.html">ElementReference</a></li><li><a href="Enumeration.html">Enumeration</a></li><li><a href="EventDescriptor.html">EventDescriptor</a></li><li><a href="ExpressionDataMapping.html">ExpressionDataMapping</a></li><li><a href="Flow.html">Flow</a></li><li><a href="FlowTranslateComposer.html">FlowTranslateComposer</a></li><li><a href="HttpService.html">HttpService</a></li><li><a href="HttpService.DataType.html">DataType</a></li><li><a href="ImageGallery.html">ImageGallery</a></li><li><a href="ImageGalleryItem.html">ImageGalleryItem</a></li><li><a href="IndexedDBDataService.html">IndexedDBDataService</a></li><li><a href="Main.html">Main</a></li><li><a href="MappingRule.html">MappingRule</a></li><li><a href="Message.html">Message</a></li><li><a href="MessageFormat.html">MessageFormat</a></li><li><a href="Model.html">Model</a></li><li><a href="ModelGroup.html">ModelGroup</a></li><li><a href="module-_._foo.reel_.Foo.html">Foo</a></li><li><a href="module-_montage_ui_condition.reel_-Condition.html">Condition</a></li><li><a href="module-_montage_ui_flow.reel_-Flow.html">Flow</a></li><li><a href="module-_montage_ui_loader.reel_-Loader.html">Loader</a></li><li><a href="module-_montage_ui_native_button.reel_.Button.html">Button</a></li><li><a href="module-_montage_ui_native_checkbox.reel_.Checkbox.html">Checkbox</a></li><li><a href="module-_montage_ui_native_image.reel_.Image.html">Image</a></li><li><a href="module-_montage_ui_native_input-date.reel_.InputDate.html">InputDate</a></li><li><a href="module-_montage_ui_native_input-number.reel_.InputNumber.html">InputNumber</a></li><li><a href="module-_montage_ui_native_input-radio.reel_.InputRadio.html">InputRadio</a></li><li><a href="module-_montage_ui_native_input-range.reel_.InputRange.html">InputRange</a></li><li><a href="module-_montage_ui_native_input-text.reel_.InputText.html">InputText</a></li><li><a href="module-_montage_ui_native_progress.reel_.Progress.html">Progress</a></li><li><a href="module-_montage_ui_native_select.reel_.Select.html">Select</a></li><li><a href="module-_montage_ui_native_textarea.reel_.Textarea.html">Textarea</a></li><li><a href="module-_montage_ui_repetition.reel_-Iteration.html">Iteration</a></li><li><a href="module-_montage_ui_repetition.reel_-Repetition.html">Repetition</a></li><li><a href="module-_montage_ui_segmented-bar.reel_-SegmentedBar.html">SegmentedBar</a></li><li><a href="module-_montage_ui_slot.reel_-Slot.html">Slot</a></li><li><a href="module-_montage_ui_substitution.reel_-Substitution.html">Substitution</a></li><li><a href="module-_montage_ui_succession.reel_-Succession.html">Succession</a></li><li><a href="module-_ui_anchor.reel_.Anchor.html">Anchor</a></li><li><a href="module-_ui_main.reel_.Main.html">Main</a></li><li><a href="module-_ui_modal-overlay.reel_-ModalOverlay.html">ModalOverlay</a></li><li><a href="module-_ui_overlay.reel_-Overlay.html">Overlay</a></li><li><a href="module-_ui_segmented-bar.reel_segment.reel_.Segment.html">Segment</a></li><li><a href="module-core_application-Application.html">Application</a></li><li><a href="module-montage_composer_composer-Composer.html">Composer</a></li><li><a href="module-montage_composer_key-composer-KeyComposer.html">KeyComposer</a></li><li><a href="module-montage_composer_press-composer-PressComposer.html">PressComposer</a></li><li><a href="module-montage_composer_swipe-composer-SwipeComposer.html">SwipeComposer</a></li><li><a href="module-montage_composer_translate-composer-TranslateComposer.html">TranslateComposer</a></li><li><a href="module-montage_core_bitfield-BitField.html">BitField</a></li><li><a href="module-montage_core_converter_bytes-converter-BytesConverter.html">BytesConverter</a></li><li><a href="module-montage_core_converter_camel-case-converter-CamelCaseConverter.html">CamelCaseConverter</a></li><li><a href="module-montage_core_converter_converter-Converter.html">Converter</a></li><li><a href="module-montage_core_converter_converter-Validator.html">Validator</a></li><li><a href="module-montage_core_converter_currency-converter-CurrencyConverter.html">CurrencyConverter</a></li><li><a href="module-montage_core_converter_date-converter-DateConverter.html">DateConverter</a></li><li><a href="module-montage_core_converter_date-converter-DateValidator.html">DateValidator</a></li><li><a href="module-montage_core_converter_invert-converter-InvertConverter.html">InvertConverter</a></li><li><a href="module-montage_core_converter_kebab-case-converter-KebabCaseConverter.html">KebabCaseConverter</a></li><li><a href="module-montage_core_converter_lower-case-converter-LowerCaseConverter.html">LowerCaseConverter</a></li><li><a href="module-montage_core_converter_new-line-to-br-converter-NewLineToBrConverter.html">NewLineToBrConverter</a></li><li><a href="module-montage_core_converter_number-converter-NumberConverter.html">NumberConverter</a></li><li><a href="module-montage_core_converter_number-converter-NumberValidator.html">NumberValidator</a></li><li><a href="module-montage_core_converter_number-to-nearest-integer-converter-NumberToNearestIntegerConverter.html">NumberToNearestIntegerConverter</a></li><li><a href="module-montage_core_converter_snake-case-converter-SnakeCaseConverter.html">SnakeCaseConverter</a></li><li><a href="module-montage_core_converter_trim-converter-ExpressionConverter.html">ExpressionConverter</a></li><li><a href="module-montage_core_converter_trim-converter-TrimConverter.html">TrimConverter</a></li><li><a href="module-montage_core_converter_upper-case-converter-UpperCaseConverter.html">UpperCaseConverter</a></li><li><a href="module-montage_core_core-Montage.html">Montage</a></li><li><a href="module-montage_core_enum-Enum.html">Enum</a></li><li><a href="module-montage_core_event_action-event-listener-ActionEventListener.html">ActionEventListener</a></li><li><a href="module-montage_core_event_event-manager-EventManager.html">EventManager</a></li><li><a href="module-montage_core_event_key-manager-KeyManager.html">KeyManager</a></li><li><a href="module-montage_core_event_mutable-event-MutableEvent.html">MutableEvent</a></li><li><a href="module-montage_core_exception-Exception.html">Exception</a></li><li><a href="module-montage_core_gate-Gate.html">Gate</a></li><li><a href="module-montage_core_geometry_cubic-bezier-CubicBezier.html">CubicBezier</a></li><li><a href="module-montage_core_geometry_point-Point.html">Point</a></li><li><a href="module-montage_core_localizer-Localizer.html">Localizer</a></li><li><a href="module-montage_core_localizer-Message.html">Message</a></li><li><a href="module-montage_core_logger-Logger.html">Logger</a></li><li><a href="module-montage_core_meta_validation-rule-PropertyValidationRule.html">PropertyValidationRule</a></li><li><a href="module-montage_core_module-reference-ModuleReference.html">ModuleReference</a></li><li><a href="module-montage_core_object-controller-ObjectController.html">ObjectController</a></li><li><a href="module-montage_core_range-controller-RangeController.html">RangeController</a></li><li><a href="module-montage_core_state-chart-State.html">State</a></li><li><a href="module-montage_core_state-chart-StateChart.html">StateChart</a></li><li><a href="module-montage_core_uuid-Uuid.html">Uuid</a></li><li><a href="module-montage_data_object-property-ObjectProperty.html">ObjectProperty</a></li><li><a href="module-montage_serialization_serialization-Serialization.html">Serialization</a></li><li><a href="module-montage_serialization_serialization-SerializationExtractor.html">SerializationExtractor</a></li><li><a href="module-montage_serialization_serialization-SerializationInspector.html">SerializationInspector</a></li><li><a href="module-montage_serialization_serialization-SerializationMerger.html">SerializationMerger</a></li><li><a href="module-montage_ui_base_abstract-button-AbstractButton.html">AbstractButton</a></li><li><a href="module-montage_ui_base_abstract-control-AbstractControl.html">AbstractControl</a></li><li><a href="module-montage_ui_check-input.CheckControl.html">CheckControl</a></li><li><a href="module-montage_ui_component-Component.html">Component</a></li><li><a href="module-montage_ui_component-RootComponent.html">RootComponent</a></li><li><a href="module-montage_ui_control.Control.html">Control</a></li><li><a href="module-montage_ui_controller_media-controller-MediaController.html">MediaController</a></li><li><a href="module-montage_ui_passage-Passage.html">Passage</a></li><li><a href="module-montage_ui_text.Text.html">Text</a></li><li><a href="module-montage_ui_text-input.TextInput.html">TextInput</a></li><li><a href="ModuleObjectDescriptor.html">ModuleObjectDescriptor</a></li><li><a href="ModuleReference.html">ModuleReference</a></li><li><a href="montage_ui_base_abstract-image.module_reel-AbstractImage.html">AbstractImage</a></li><li><a href="montage_ui_base_abstract-select.module_reel-AbstractSelect.html">AbstractSelect</a></li><li><a href="montage_ui_base_abstract-slider.module_reel-AbstractSlider.html">AbstractSlider</a></li><li><a href="montage_ui_base_abstract-toggle-button.module_reel-AbstractToggleButton.html">AbstractToggleButton</a></li><li><a href="montage_ui_base_abstract-toggle-switch.module_reel-AbstractToggleSwitch.html">AbstractToggleSwitch</a></li><li><a href="montage_ui_base_abstract-video.module_reel-AbstractVideo.html">AbstractVideo</a></li><li><a href="MontageBuilder.html">MontageBuilder</a></li><li><a href="MontageReviver.html">MontageReviver</a></li><li><a href="ObjectDescriptor.html">ObjectDescriptor</a></li><li><a href="PersistentDataService.html">PersistentDataService</a></li><li><a href="PipelineConverter.html">PipelineConverter</a></li><li><a href="PromiseController.html">PromiseController</a></li><li><a href="PropertyDescriptor.html">PropertyDescriptor</a></li><li><a href="PropertyValidationSemantics.html">PropertyValidationSemantics</a></li><li><a href="RadioButtonController.html">RadioButtonController</a></li><li><a href="RangeController.html">RangeController</a></li><li><a href="RawDataService.html">RawDataService</a></li><li><a href="RawPropertyValueToObjectConverter.html">RawPropertyValueToObjectConverter</a></li><li><a href="SnapshotService.html">SnapshotService</a></li><li><a href="Target.html">Target</a></li><li><a href="Template.html">Template</a></li><li><a href="TemplateResources.html">TemplateResources</a></li><li><a href="ui_alert.module_reel-Alert.html">Alert</a></li><li><a href="ui_base_abstract-progress-bar.module_js-AbstractProgressBar.html">AbstractProgressBar</a></li><li><a href="ui_caption.module_reel-Caption.html">Caption</a></li><li><a href="ui_draggable-square.module_reel-DraggableSquare.html">DraggableSquare</a></li><li><a href="ui_list.module_reel-List.html">List</a></li><li><a href="ui_main.module_reel-Main.html">Main</a></li><li><a href="ui_montage-studio-loader.module_reel-MontageStudioLoader.html">MontageStudioLoader</a></li><li><a href="ui_press-composer-layers.module_reel-PressComposerLayers.html">PressComposerLayers</a></li><li><a href="ui_square.module_reel-Square.html">Square</a></li><li><a href="ui_tree-list.module_reel-TreeList.html">TreeList</a></li><li><a href="UserInterfaceDescriptor.html">UserInterfaceDescriptor</a></li><li><a href="-_rotation-composer.module_reel-RotationComposer.html">RotationComposer</a></li></ul><h3>Events</h3><ul><li><a href="AbstractButton.html#event:action">action</a></li><li><a href="AbstractButton.html#event:longAction">longAction</a></li><li><a href="AbstractCheckbox.html#.event:action">action</a></li><li><a href="AbstractCheckbox.html#event:action">action</a></li><li><a href="AbstractControl.html#event:action">action</a></li><li><a href="AbstractLink.html#.event:action">action</a></li><li><a href="AbstractLink.html#event:action">action</a></li><li><a href="AbstractNumberField.html#event:action">action</a></li><li><a href="AbstractRadioButton.html#.event:action">action</a></li><li><a href="AbstractRadioButton.html#event:action">action</a></li><li><a href="AbstractSelect.html#.event:action">action</a></li><li><a href="AbstractTextField.html#.event:action">action</a></li><li><a href="AbstractTextField.html#event:action">action</a></li><li><a href="AbstractToggleButton.html#.event:action">action</a></li><li><a href="AbstractToggleButton.html#.event:longAction">longAction</a></li><li><a href="AbstractToggleSwitch.html#.event:action">action</a></li><li><a href="module-montage_ui_control.html#~event:longpress">longpress</a></li><li><a href="module-_montage_ui_native_button.reel_.Button.html#.event:action">action</a></li><li><a href="module-_montage_ui_native_button.reel_.Button.html#.event:hold">hold</a></li><li><a href="module-_montage_ui_segmented-bar.reel_-SegmentedBar.html#event:action">action</a></li><li><a href="module-_montage_ui_segmented-bar.reel_-SegmentedBar.html#event:longAction">longAction</a></li><li><a href="module-montage_ui_base_abstract-button-AbstractButton.html#event:action">action</a></li><li><a href="montage_ui_base_abstract-select.module_reel-AbstractSelect.html#event:action">action</a></li><li><a href="montage_ui_base_abstract-slider.module_reel-AbstractSlider.html#event:action">action</a></li><li><a href="montage_ui_base_abstract-toggle-button.module_reel-AbstractToggleButton.html#event:action">action</a></li><li><a href="montage_ui_base_abstract-toggle-switch.module_reel-AbstractToggleSwitch.html#event:action">action</a></li><li><a href="Overlay.html#.event:dismiss">dismiss</a></li><li><a href="PressComposer.html#.event:longPress">longPress</a></li><li><a href="PressComposer.html#.event:press">press</a></li><li><a href="PressComposer.html#.event:pressCancel">pressCancel</a></li><li><a href="PressComposer.html#.event:pressStart">pressStart</a></li><li><a href="RotationComposer.html#.event:rotation">rotation</a></li><li><a href="RotationComposer.html#.event:rotationStart">rotationStart</a></li><li><a href="SegmentedBar.html#event:action">action</a></li><li><a href="UndoManager.html#.event:operationRegistered">operationRegistered</a></li><li><a href="UndoManager.html#.event:redo">redo</a></li><li><a href="UndoManager.html#.event:undo">undo</a></li></ul><h3>Namespaces</h3><ul><li><a href="EventManager.html">EventManager</a></li></ul><h3>Global</h3><ul><li><a href="global.html#_isLinkLoadEventAvailable">_isLinkLoadEventAvailable</a></li><li><a href="global.html#_offlinePrimaryKeys">_offlinePrimaryKeys</a></li><li><a href="global.html#_webkitVersion">_webkitVersion</a></li><li><a href="global.html#addPrimaryKeyDependency">addPrimaryKeyDependency</a></li><li><a href="global.html#AuthorizationPolicy">AuthorizationPolicy</a></li><li><a href="global.html#childrenExpression">childrenExpression</a></li><li><a href="global.html#childrenFromNode">childrenFromNode</a></li><li><a href="global.html#collapseAll">collapseAll</a></li><li><a href="global.html#collapseNode">collapseNode</a></li><li><a href="global.html#compiledSyntax">compiledSyntax</a></li><li><a href="global.html#converters">converters</a></li><li><a href="global.html#createDefaultBlueprintForObject">createDefaultBlueprintForObject</a></li><li><a href="global.html#createDefaultObjectDescriptorForObject">createDefaultObjectDescriptorForObject</a></li><li><a href="global.html#data">data</a></li><li><a href="global.html#deserialize">deserialize</a></li><li><a href="global.html#determinate">determinate</a></li><li><a href="global.html#error">error</a></li><li><a href="global.html#expandAll">expandAll</a></li><li><a href="global.html#expandNode">expandNode</a></li><li><a href="global.html#expression">expression</a></li><li><a href="global.html#fooCount">fooCount</a></li><li><a href="global.html#fulfilled">fulfilled</a></li><li><a href="global.html#group">group</a></li><li><a href="global.html#handleTreeChange">handleTreeChange</a></li><li><a href="global.html#identifier">identifier</a></li><li><a href="global.html#initiallyExpanded">initiallyExpanded</a></li><li><a href="global.html#initMontage">initMontage</a></li><li><a href="global.html#initWithExpression">initWithExpression</a></li><li><a href="global.html#initWithObjects">initWithObjects</a></li><li><a href="global.html#initWithPath">initWithPath</a></li><li><a href="global.html#initWithSyntax">initWithSyntax</a></li><li><a href="global.html#isNodeExpanded">isNodeExpanded</a></li><li><a href="global.html#manager">manager</a></li><li><a href="global.html#MontageInterpreter">MontageInterpreter</a></li><li><a href="global.html#ok">ok</a></li><li><a href="global.html#parameters">parameters</a></li><li><a href="global.html#pending">pending</a></li><li><a href="global.html#progress">progress</a></li><li><a href="global.html#progressState">progressState</a></li><li><a href="global.html#promise">promise</a></li><li><a href="global.html#referenceFromValue">referenceFromValue</a></li><li><a href="global.html#rejected">rejected</a></li><li><a href="global.html#state">state</a></li><li><a href="global.html#syntax">syntax</a></li><li><a href="global.html#value">value</a></li><li><a href="global.html#valueFromReference">valueFromReference</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.3.2</a> on Wed Nov 15 2017 12:53:29 GMT-0800 (PST)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
