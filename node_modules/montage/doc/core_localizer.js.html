<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: core/localizer.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: core/localizer.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>    /*global require,exports */

/**
 * @module montage/core/localizer
 * @requires montage/core/core
 * @requires montage/core/logger
 * @requires montage/core/deserializer
 * @requires montage/core/promise
 * @requires montage/core/messageformat
 * @requires montage/core/messageformat-locale
 */
var Montage = require("./core").Montage,
    MessageFormat = require("./messageformat"),
    rootComponent = require("../ui/component").__root__,
    logger = require("./logger").logger("localizer"),
    Serializer = require("./serialization/serializer/montage-serializer").MontageSerializer,
    Deserializer = require("./serialization/deserializer/montage-deserializer").MontageDeserializer,
    Promise = require("./promise").Promise,
    Bindings = require("./core").Bindings,
    FrbBindings = require("frb/bindings"),
    stringify = require("frb/stringify"),
    expand = require("frb/expand"),
    Map = require("collections/map"),
    Scope = require("frb/scope");

// Add all locales to MessageFormat object
MessageFormat.locale = require("./messageformat-locale");

var KEY_KEY = "key",
    DEFAULT_MESSAGE_KEY = "default",
    LOCALE_STORAGE_KEY = "montage_locale",

    // directory name that the locales are stored under
    LOCALES_DIRECTORY = "locale",
    // filename (without extension) of the file that contains the messages
    MESSAGES_FILENAME = "messages",
    // filename of the manifest file
    MANIFEST_FILENAME = "manifest.json";

var EMPTY_STRING_FUNCTION = function () { return ""; };

// This is not a strict match for the grammar in
// http://tools.ietf.org/html/rfc5646, but it's good enough for our purposes.
var reLanguageTagValidator = /^[a-zA-Z]+(?:-[a-zA-Z0-9]+)*$/;

var defaultLocalizer;

/**
 * @class Localizer
 * @extends Montage
 */
var Localizer = exports.Localizer = Montage.specialize( /** @lends Localizer.prototype # */ {

    /**
     * @function
     * @param {string} [locale] The RFC-5646 language tag this localizer should use. Defaults to defaultLocalizer.locale
     * @returns {Localizer} The Localizer object it was called on.
     */
    initWithLocale: {
        value: function (locale) {
            var defaultLocaleStored;

            if (this.storesLocale &amp;&amp; typeof window !== "undefined" &amp;&amp; window.localStorage) {
                defaultLocaleStored = window.localStorage.getItem(LOCALE_STORAGE_KEY);
            }

            var locateCandidate = locale || defaultLocaleStored || window.navigator.userLanguage || window.navigator.language || Localizer.defaultLocale,
                defaultLocale = this.callDelegateMethod("localizerWillUseLocale", this, locateCandidate);

            this.locale = defaultLocale || locateCandidate;
            this._isInitialized = true;

            this.loadMessages();

            return this;
        }
    },


    initWithLocaleAndDelegate: {
        value: function (locale, delegate) {
            this.delegate = delegate;

            return this.initWithLocale(locale);
        }
    },


    storesLocale: {
        value: false
    },


    component: {
        value: null
    },


    _delegate: {
        value: null
    },

    /**
     * Delegate to get the default locale or the locale messages.
     * Should implement a `getDefaultLocale` method that returns
     * a language-tag string that can be passed to {@link locale}
     * Should implement a `localizerWillLoadMessages` method that returns
     * a Promise that will return a "messages" object with a combination of keys/messages.
     *
     * @example
     * myDelegate.localizerWillLoadMessages = function () {
     *     return Promise(function (resolve, reject){
     *          return {
     *              language_key: "English",
     *              hello_key: "Hello"
     *          };
     *     });
     * }
     *
     * @type Object
     * @default null
     */
    delegate: {
        set: function (delegate) {
            if (!this._delegate &amp;&amp; delegate &amp;&amp; typeof delegate === "object") {
                this._delegate = delegate;
            }
        },
        get: function () {
            return this._delegate;
        }
    },

    _isInitialized: {
        value: false
    },

    isInitialized: {
        get: function () {
            return this._isInitialized;
        }
    },

    /**
     * The MessageFormat object to use.
     * @type {MessageFormat}
     * @default null
     */
    messageFormat: {
        serializable: false,
        value: null
    },

    _messages: {
        value: null
    },

    /**
     * A map from keys to messages.
     * @type Object
     * @default null
     */
    messages: {
        get: function () {
            return this._messages;
        },
        set: function (value) {
            if (this._messages !== value) {
                if (value !== undefined &amp;&amp; value !== null &amp;&amp; typeof value !== "object") {
                    throw new TypeError(value, " is not an object");
                }

                this._messages = value;
            }
        }
    },

    /**
     * A promise for the messages property
     * @type Promise
     * @default null
     */
    messagesPromise: {
        serializable: false,
        value: null
    },

    _locale: {
        value: null
    },

    /**
     * A RFC-5646 language-tag specifying the locale of this localizer.
     * Setting the locale will create a new {@link MessageFormat} object with
     * the new locale.
     * @type {string}
     * @default null
     */
    locale: {
        get: function () {
            return this._locale;
        },
        set: function (value) {
            if (!reLanguageTagValidator.test(value)) {
                throw new TypeError("Language tag '" + value + "' is not valid. It must match http://tools.ietf.org/html/rfc5646 (alphanumeric characters separated by hyphens)");
            }

            if (this._locale !== value) {
                var previousLocale = this._locale;

                this._locale = value;
                this.messageFormat = new MessageFormat(value);

                if (previousLocale &amp;&amp; previousLocale !== this._locale) {
                    var self = this;

                    this.loadMessages().then(function () {
                        self._dispatchLocaleChange(previousLocale);
                    });
                }

                if (this.storesLocale &amp;&amp; typeof window !== "undefined" &amp;&amp; window.localStorage) {
                    // If possible, save locale
                    try {
                        window.localStorage.setItem(LOCALE_STORAGE_KEY, value);
                    } catch (e) {
                        // LocalStorage quota might have been exceeded
                        // iOS Safari emits a quota exceeded error from private mode always
                    }
                }
            }
        }
    },

    _availableLocales: {
        value: null
    },

    /**
     * A promise for the locales available in this package. Resolves to an
     * array of strings, each containing a locale tag.
     * @type Promise
     * @default null
     *
     * @returns {Promise.&lt;Array.&lt;String>>}
     */
    availableLocales: {
        get: function () {
            if (this._availableLocales) {
                return this._availableLocales;
            }

            this._availableLocales = this.callDelegateMethod("localizerWillPromiseAvailableLocales", this);

            if (!this._availableLocales) {
                this._availableLocales = this._manifest.get("files").get(LOCALES_DIRECTORY).get("files").then(function (locales) {
                    return Object.keys(locales);
                });
            }

            return this._availableLocales;
        }
    },

    _require: {
        value: global.require
    },

    /**
     * The require function to use in {@link loadMessages}.
     * By default this is set to the global require, meaning that messages
     * will be loaded from the root of the application. To load messages
     * from the root of your package set this to the require function from
     * any class in the package.
     * @type Function
     * @default global require | null
     */
    require: {
        serializable: false,
        get: function () {
            return this._require;
        },
        set: function (value) {
            if (this._require !== value) {
                this.__manifest = null;
                this._require = value;
            }
        }
    },

    __manifest: {
        value: null
    },

    /**
     * Promise for the manifest
     * @private
     * @type Promise
     * @default null
     */
    _manifest: {
        depends: ["require"],
        get: function () {
            var messageRequire = this.require;

            if (messageRequire.packageDescription.manifest === true) {
                if (!this.__manifest) {
                    this.__manifest = messageRequire.async(MANIFEST_FILENAME);
                }
                return this.__manifest;
            } else {
                return Promise.reject(new Error(
                    "Package has no manifest. " + messageRequire.location +
                    "package.json must contain \"manifest\": true and " +
                    messageRequire.location+MANIFEST_FILENAME+" must exist"
                ));
            }
        }
    },

    loadMessagesTimeout: {
        value: 5000
    },

    /**
     * Load messages for the locale
     * @function
     * @param {?number|boolean} [timeout=5000] Number of milliseconds to wait
     * before failing. Set to false for no timeout.
     * @param {Function} [callback] Called on successful loading of messages.
     * Using the returned promise is recomended.
     * @returns {Promise} A promise for the messages.
     */
    loadMessages: {
        value: function (timeout, callback) {
            if (!this.require) {
                throw new Error("Cannot load messages as", this, "require is not set");
            }

            if (typeof timeout !== "number") {
                timeout = this.loadMessagesTimeout;
            }

            this.messages = null;

            var self = this,
                promise = this.callDelegateMethod("localizerWillLoadMessages",this);

            //A delegate may have set a different timeout:
            if(this.hasOwnProperty("loadMessagesTimeout")) {
                timeout = this.loadMessagesTimeout;
            }

            if (promise) {
                promise = promise.timeout(timeout);

            } else {
                promise = this._manifest.timeout(timeout).then(function (manifest) {
                    return self._loadMessageFiles(manifest.files);
                });
            }

            this.messagesPromise = promise.then(function (localesMessages) {
                return self._collapseMessages(localesMessages);
            },function(error) {
                console.error("Could not load messages for '" + self.locale + "': " + error);
                throw error;
            }).then(function (messages) {
                if (typeof callback === "function") {
                    callback(messages);
                }

                return messages;
            });

            return this.messagesPromise;
        }
    },

    /**
     * Load the locale appropriate message files from the given manifest
     * structure.
     * @function
     * @param {Object} files An object mapping directory (locale) names to
     * @returns {Promise} A promise that will be resolved with an array
     * containing the content of message files appropriate to this locale.
     * Suitable for passing into {@link _collapseMessages}.
     * @private
     */
    _loadMessageFiles: {
        value: function (files) {
            var messageRequire = this.require;

            if (!files) {
                return Promise.reject(new Error(
                    messageRequire.location + MANIFEST_FILENAME +
                    " does not contain a 'files' property"
                ));
            }

            var availableLocales, localesMessagesP = [], fallbackLocale, localeFiles, filename;

            if (!(LOCALES_DIRECTORY in files)) {
                return Promise.reject(new Error(
                    "Package does not contain a '" + LOCALES_DIRECTORY + "' directory"
                ));
            }

            availableLocales = files[LOCALES_DIRECTORY].files;
            fallbackLocale = this._locale;

            // Fallback through the language tags, loading any available
            // message files
            while (fallbackLocale !== "") {
                if (availableLocales.hasOwnProperty(fallbackLocale)) {
                    localeFiles = availableLocales[fallbackLocale].files;

                    // Look for Javascript or JSON message files, with the
                    // compiled JS files taking precedence
                    if ((filename = MESSAGES_FILENAME + ".js") in localeFiles ||
                        (filename = MESSAGES_FILENAME + ".json") in localeFiles
                    ) {
                        // Require the message file
                        localesMessagesP.push(messageRequire.async(LOCALES_DIRECTORY + "/" + fallbackLocale + "/" + filename));
                    } else if(logger.isDebug) {
                        logger.debug(this, "Warning: '" + LOCALES_DIRECTORY + "/" + fallbackLocale +
                            "/' does not contain '" + MESSAGES_FILENAME + ".json' or '" + MESSAGES_FILENAME + ".js'");
                    }

                }
                // Strip the last language tag off of the locale
                fallbackLocale = fallbackLocale.substring(0, fallbackLocale.lastIndexOf("-"));
            }

            if (!localesMessagesP.length) {
                return Promise.reject(new Error("Could not find any " + MESSAGES_FILENAME + ".json or " + MESSAGES_FILENAME + ".js files"));
            }

            var promise = Promise.all(localesMessagesP);
            if (logger.isDebug) {
                var self = this;
                promise = promise.then(function (localesMessages) {
                    logger.debug(self, "loaded " + localesMessages.length + " message files");
                    return localesMessages;
                });
            }
            return promise;
        }
    },

    /**
     * Collapse an array of message objects into one, earlier elements taking
     * precedence over later ones.
     * @function
     * @param {Array&lt;Object>} localesMessages
     * @returns {Object} An object mapping messages keys to the messages
     * @example
     * [{hi: "Good-day"}, {hi: "Hello", bye: "Bye"}]
     * // results in
     * {hi: "Good-day", bye: "Bye"}
     * @private
     */
    _collapseMessages: {
        value: function (localesMessages) {
            var messages = {};

            // Go through each set of messages, adding any keys that haven't
            // already been set
            for (var i = 0, l = localesMessages.length; i &lt; l; i++) {
                var localeMessages = localesMessages[i];
                for (var key in localeMessages) {
                    if (localeMessages.hasOwnProperty(key)) {
                        if (!(key in messages)) {
                            messages[key] = localeMessages[key];
                        }
                    }
                }
            }
            this.messages = messages;
            return messages;
        }
    },

    // Caches the compiled functions from strings
    _compiledMessageCache: {
        value: Object.create(null)
    },

    /**
     * Localize a key and return a message function.
     *
     * If the message is a precompiled function then this is returned
     * directly. Otherwise the message string is compiled to a function with
     * &lt;a href="https://github.com/SlexAxton/messageformat.js#readme">
     * messageformat.js&lt;/a>. The resulting function takes an object mapping
     * from variables in the message to their values.
     *
     * Be aware that if the messages have not loaded yet this method
     * will not return the localized string. See `localize` for
     * method that works whether the messages have loaded or not.
     *
     * @function
     * @param {string} key The key to the string in the {@link messages} object.
     * @param {string} defaultMessage The value to use if key does not exist.
     * @returns {Function} A function that accepts an object mapping variables
     * in the message string to values.
     */
    localizeSync: {
        value: function (key, defaultMessage) {
            var message, type, compiled;

            if (!key &amp;&amp; !defaultMessage) {
                throw new Error("Key or default message must be truthy, not " + key + " and " + defaultMessage);
            }

            if (this._messages &amp;&amp; key in this._messages) {
                message = this._messages[key];
                type = typeof message;

                if (type === "function") {
                    return message;
                } else if (type === "object") {
                    if (!("message" in message)) {
                        throw new Error(message, "does not contain a 'message' property");
                    }

                    message = message.message;
                }
            } else {
                message = defaultMessage;
            }

            if (!message) {
                console.warn("No message or default message for key '"+ key +"'");
                // Give back something so there's at least something for the UI
                message = key;
            }

            if (message in this._compiledMessageCache) {
                return this._compiledMessageCache[message];
            }

            var ast = this.messageFormat.parse(message);
            // if we have a simple string then create a very simple function,
            // and set it as its own toString so that it behaves a bit like
            // a string
            if (ast.program &amp;&amp; ast.program.statements &amp;&amp; ast.program.statements.length === 1 &amp;&amp; ast.program.statements[0].type === "string") {
                compiled = function () { return message; };
                compiled.toString = compiled;
            } else {
                /* jshint evil:true */
                compiled = (new Function('MessageFormat', 'return ' + this.messageFormat.precompile(ast))(MessageFormat));
                /* jshint evil:false */
            }

            this._compiledMessageCache[message] = compiled;
            return compiled;
        }
    },

    /**
     * Async version of {@link localize}.
     *
     * Waits for the localizer to get messages before localizing the key.
     * Use either the callback or the promise.
     *
     * ```js
     * defaultLocalizer.localize("hello_name", "Hello, {name}!").then(function (hi) {
     *     console.log(hi({name: "World"})); // => "Hello, World!""
     *     console.log(hi()); // => Error: MessageFormat: No data passed to function.
     * });
     * ```
     *
     * If the message for the key is "simple", i.e. it does not contain any
     * variables, then the function will implement a custom `toString`
     * function that also returns the message. This means that you can use
     * the function like a string. Example:
     *
     * ```js
     * defaultLocalizer.localize("hello", "Hello").then(function (hi) {
     *     // Concatenating an object to a string calls its toString
     *     myObject.hello = "" + hi;
     *     var y = "The greeting '" + hi + "' is used in this locale";
     *     // textContent only accepts strings and so calls toString
     *     button.textContent = hi;
     *     // and use as a function also works.
     *     var z = hi();
     * });
     * ```
     *
     * @function
     * @param {string} key The key to the string in the {@link messages}
     * object.
     * @param {string} defaultMessage The value to use if key does not exist.
     * @param {string} [defaultOnFail=true] Whether to use the default messages
     * if the messages fail to load.
     * @param {Function} [callback] Passed the message function.
     * @returns {Promise} A promise that is resolved with the message function.
    */
    localize: {
        value: function (key, defaultMessage, defaultOnFail, callback) {
            defaultOnFail = (typeof defaultOnFail === "undefined") ? true : defaultOnFail;

            var self = this,
                promise;

            if (!this._isInitialized) {
                this.initWithLocale();

                promise = this.messagesPromise.then(function () {
                    return (self.localize(key, defaultMessage, defaultOnFail, callback));
                });

            } else if (!this.messagesPromise) {
                promise = Promise.resolve(this.localizeSync(key, defaultMessage));
                promise.then(callback);

            } else {
                var l = function () {
                    var messageFn = self.localizeSync(key, defaultMessage);

                    if (typeof callback === "function") {
                        callback(messageFn);
                    }

                    return messageFn;
                };

                if (defaultOnFail) {
                    // Try and localize the message, no matter what the outcome
                    promise = this.messagesPromise.then(l, l);

                } else {
                    promise = this.messagesPromise.then(l);
                }
            }

            return promise;
        }
    },

    /**
     * Reset the saved locale back to default by using the steps above.
     * @function
     * @returns {string} the reset locale
     */
    reset: {
        value: function () {
            if (this.storesLocale &amp;&amp; typeof window !== "undefined" &amp;&amp; window.localStorage) {
                window.localStorage.removeItem(LOCALE_STORAGE_KEY);
            }

            this.initWithLocale();

            return this._locale;
        }
    },

    _dispatchLocaleChangeAsNeeded: {
        value: function (previousLocale, component) {
            if (component &amp;&amp; (component.localizer === null || component.localizer === void 0 || component.localizer === this)) {
                if (typeof component.localizerDidChangeLocale === "function") {
                    component.localizerDidChangeLocale(this, previousLocale, this._locale);
                }

                return true;
            }

            return false;
        }
    },


    _dispatchLocaleChange: {
        value: function (previousLocale, _component) {
            if (!_component) {
                _component = this.component || rootComponent;

                if (!this._dispatchLocaleChangeAsNeeded(previousLocale, _component)) {
                    return;
                }
            }

            // Get the private `_childComponents` in order to avoid to create an empty array,
            // indeed childComponents is set lazily.
            var childComponents = _component._childComponents;

            if (childComponents) {
                var child;

                for (var i = 0; i &lt; childComponents.length; i++) {
                    child = childComponents[i];

                    if (this._dispatchLocaleChangeAsNeeded(previousLocale, child)) {
                        if (child._childComponents) {
                            this._dispatchLocaleChange(previousLocale, child);
                        }
                    }
                }
            }
        }
    }

}, {

    defaultLocalizer: {
        value: function () {
            if (!defaultLocalizer) {
                defaultLocalizer = new Localizer();
                defaultLocalizer.storesLocale = true;
            }

            return defaultLocalizer;
        }
    },

    defaultLocalizerWithDelegate: {
        value: function (delegate) {
            this.defaultLocalizer();
            defaultLocalizer.delegate = delegate;

            return defaultLocalizer;
        }
    },

    defaultLocale: {
        value: "en"
    }

});

/**
 * The default localizer.
 * The locale of the defaultLocalizer is determined by following these steps:
 *
 * - If localStorage exists, use the value stored in "montage_locale"
 *   (LOCALE_STORAGE_KEY)
 * - Otherwise use the value of navigator.userLanguage (Internet Explorer)
 * - Otherwise use the value of navigator.language (other browsers)
 * - Otherwise fall back to "en"
 *
 * `defaultLocalizer.locale` can be set and if localStorage exists then the
 * value will be saved in
 *
 * "montage_locale" (LOCALE_STORAGE_KEY).
 */

Object.defineProperty(exports, "defaultLocalizer", {
    get: function () {
        return Localizer.defaultLocalizer();
    }
});


/** The localize function from {@link defaultLocalizer} provided for
 * convenience.
 *
 * @function
 * @see Localizer#localize
 */
var _localize;

Object.defineProperty(exports, "localize", {
    get: function () {
        if (!_localize) {
            var _defaultLocalizer = Localizer.defaultLocalizer();

            _localize = _defaultLocalizer.bind(_defaultLocalizer);
        }

        return _localize;
    }
});

/**
 * Tracks a message function and its data for changes in order to generate a
 * localized message.
 *
 * @class Message
 * @extends Montage
 */
var Message = exports.Message = Montage.specialize( /** @lends Message.prototype # */ {
    /**
     * @constructs Message
     */
    constructor: {
        value: function () {
            //todo: optimisation? set a flag on the localizer to listen when the locale change?
            this.addPathChangeListener("localizer.locale", this, "handleLocaleChange");
        }
    },

    /**
     * @function
     * @param {string|function} keyOrFunction A messageformat string or a
     * function that takes an object argument mapping variables to values and
     * returns a string. Usually the output of Localizer#localize.
     * @param {Object} data  Value for this data property.
     * @returns {Message} this.
     */
    init: {
        value: function (key, defaultMessage, data) {
            if (key) {
                this.key = key;
            }

            if (defaultMessage) {
                this.defaultMessage = defaultMessage;
            }

            if (data) {
                this.data = data;
            }

            return this;
        }
    },

    _localizer: {
        value: null
    },

    localizer: {
        get: function () {
            if (!this._localizer) {
                this._localizer = Localizer.defaultLocalizer();
            }

            return this._localizer;
        },
        set: function (value) {
            if (this._localizer === value) {
                return;
            }
            this._localizer = value;
            this._localize();
        }
    },

    _key: {
        value: null
    },

    /**
     * A key for the default localizer to get the message function from.
     * @type {string}
     * @default null
     */
    key: {
        get: function () {
            return this._key;
        },
        set: function (value) {
            if (this._key === value) {
                return;
            }

            this._key = value;
            this._localize();
        }
    },

    _defaultMessage: {
        value: null
    },

    defaultMessage: {
        get: function () {
            return this._defaultMessage;
        },
        set: function (value) {
            if (this._defaultMessage === value) {
                return;
            }

            this._defaultMessage = value;
            this._localize();
        }
    },

    handleLocaleChange: {
        value: function () {
            if (this._key &amp;&amp; this._localizer &amp;&amp; this._localizer.isInitialized) {
                this._localize();
            }
        }
    },

    _isLocalizeQueued: {
        value: false
    },

    _localize: {
        value: function () {
            if (this._isLocalizeQueued) {
                return;
            }
            this._isLocalizeQueued = true;

            var self = this;

            // Replace the _messageFunction promise with the real one.
            this._messageFunction = new Promise(function (resolve, reject) {
                // Set up a new promise now, so anyone accessing it in this tick
                // won't get the old one.
                setTimeout(function () {
                    self._isLocalizeQueued = false;

                        if (!self._key &amp;&amp; !self._defaultMessage) {
                            // TODO: Revisit when components inside repetitions aren't uselessly instatiated.
                            // While it might seem like we should reject here, when
                            resolve(EMPTY_STRING_FUNCTION);
                            return;
                        }

                        resolve(self._localizer.localize(
                            self._key,
                            self._defaultMessage
                        ));
                    }, 0);
                });

            // Don't use fcall, so that if the `data` object is completely
            // changed we have the latest version.
            this.localized = this._messageFunction.then(function (fn) {
                return self._optimizedMessageCallBack(fn);
            });
        }
    },

    __messageFunction: {
        value: null
    },

    _messageFunction: {
        set: function (messageFunction) {
            this.__messageFunction = messageFunction;
        },
        get: function () {
            if (!this.__messageFunction) {
                this.__messageFunction = Promise.resolve(EMPTY_STRING_FUNCTION);
            }

            return this.__messageFunction;
        }
    },

    _data: {
        value: null
    },

    // Receives an object literal and creates a Map that tracks it.
    data: {
        get: function () {
            if (!this._data) {
                this._data = new Map();
                this._data.addMapChangeListener(this, "data");
            }

            return this._data;
        },
        set: function (data) {
            if (this._data === data) {
                return;
            }

            if (data) {
                // optimisation avoid to call the getter and remove/add listeners
                if (!this._data) {
                    this._data = new Map();

                } else {
                    this.data.removeMapChangeListener(this, "data");

                    if (this._data.length) {
                        this._data.clear();
                    }
                }

                for (var d in data) {
                    if (data.hasOwnProperty(d)) {
                        this.data.set(d, data[d]);
                    }
                }

                this._data.addMapChangeListener(this, "data");
                this.handleDataMapChange();
            }
        }
    },

    // TODO: Remove when possible to bind to promises
    __localizedResolved: {
        value: ""
    },

    _localizedDeferred: {
        value: Promise.resolve()
    },
    /**
        The message localized with all variables replaced.
        @type {string}
        @default ""
    */
    localized: {
        get: function() {
            this._localize();
            return this._localizedDeferred;
        },
        set: function (value) {
            if (value === this._localized) {
                return;
            }
            var self = this;

            // We create our own deferred so that if localized gets set in
            // succession without being resolved, we can replace the old
            // promises with the new one transparently.
            if(this._localizedDeferred) {
                value = Promise.resolve(value);
            }
            //this._localizedDeferred.resolve(deferred.promise);
            //value.then(deferred.resolve, deferred.reject);

            // TODO: Remove when possible to bind to promises
            value.then(function (message) {
                return (self.__localizedResolved = message);
            });

            this._localizedDeferred = value;
        }
    },

    /**
     * Whenever there is a change set the localized property.
     * @type {Function}
     * @private
     */
    handleDataMapChange: {
        value: function (event) {
            if (this._key) {
                var self = this;

                this.localized = this._messageFunction.then(function (fn) {
                    return self._optimizedMessageCallBack(fn);
                });
            }
        }
    },

    // Optimisation: avoid to create garbage and useless Map objects.
    _optimizedMessageCallBack: {
        value: function (fn) {
            if (this._data) {
                return fn(this.data.toObject());
            }

            return fn();
        }
    },

    serializeSelf: {
        value: function (serializer) {
            var result = {
                _bindingDescriptors: this._bindingDescriptors
            };

            // don't serialize the message function
            result.key = this._key;
            result.defaultMessage = this._defaultMessage;

            // only serialize localizer if it isn't the default one
            if (this._localizer !== Localizer.defaultLocalizer()) {
                result.localizer = this._localizer;
            }

            return result;
        }
    },

    serializeForLocalizations: {
        value: function (serializer) {
            var result = {},
                data,
                bindings;

            bindings = FrbBindings.getBindings(this);

            if (bindings &amp;&amp; bindings.get("key")) {
                result[KEY_KEY] = {};
                this._serializeBinding(this, result[KEY_KEY], bindings.get("key"), serializer);
            } else {
                result[KEY_KEY] = this._key;
            }

            if (bindings &amp;&amp; bindings.defaultMessage) {
                result[DEFAULT_MESSAGE_KEY] = {};
                this._serializeBinding(this, result[DEFAULT_MESSAGE_KEY], bindings.defaultMessage, serializer);
            } else {
                result[DEFAULT_MESSAGE_KEY] = this._defaultMessage;
            }

            var dataBindings = FrbBindings.getBindings(this.data);

            // NOTE: Can't use `Montage.getSerializablePropertyNames(this._data)`
            // because the properties we want to serialize are not defined
            // using `Montage.defineProperty`, and so don't have
            // `serializable: true` as part of the property descriptor.
            data = this.data.toObject();

            for (var p in data) {
                if (data.hasOwnProperty(p) &amp;&amp;
                    (!dataBindings || !dataBindings[".get('"+ p + "')"])
                ) {
                    result.data = result.data || {};
                    result.data[p] = data[p];
                }
            }

            var key, b,
                mapIter = dataBindings.keys();

            // Loop through bindings seperately in case the bound properties
            // haven't been set on the data object yet.
            while ((b = mapIter.next().value)) {
                // binding is in the form of "get('key')" because it's a map
                // but we want to serialize into an object literal instead.
                key = /\.get\('([^']+)'\)/.exec(b)[1];

                result.data = result.data || {};
                result.data[key] = {};
                this._serializeBinding(this.data, result.data[key], dataBindings.get(b), serializer);
            }


            // Loop through bindings seperately in case the bound properties
            // haven't been set on the data object yet.
            // for (b in dataBindings) {
            //     // binding is in the form of "get('key')" because it's a map
            //     // but we want to serialize into an object literal instead.
            //     var key = /\.get\('([^']+)'\)/.exec(b)[1];

            //     result.data = result.data || {};
            //     result.data[key] = {};
            //     this._serializeBinding(this.data, result.data[key], dataBindings[b], serializer);
            // }

            return result;
        }
    },

    _serializeBinding: {
        value: function (object, output, input, serializer) {
            //bindingsParameters = ["&lt;-", "&lt;->", "source", "revert", "convert", "trace", "serializable"];
            //
            //bindingsParameters.forEach(function (key) {
            //    if (key in binding) {
            //        data[key] = binding[key];
            //    }
            //});

            if (("serializable" in input) &amp;&amp; !input.serializable) {
                return;
            }

            var scope,
                syntax = input.sourceSyntax;
                
            if (input.source !== object) {
                var reference = serializer.addObjectReference(input.source);
                scope = new Scope({
                    type: "component",
                    label: reference["@"]
                });
                scope.components = serializer;
                syntax = expand(syntax, scope);
            }

            scope = new Scope();
            scope.components = serializer;
            var sourcePath = stringify(syntax, scope);

            if (input.twoWay) {
                output["&lt;->"] = sourcePath;
            } else {
                output["&lt;-"] = sourcePath;
            }

            if (input.converter) {
                output.converter = input.converter;
            } else {
                output.convert = input.convert;
                output.revert = input.revert;
            }

            if (input.trace) {
                output.trace = true;
            }
        }
    }
});

var createMessageBinding = function (object, prop, key, defaultMessage, data, deserializer) {
    var message = new Message();

    if (data) {
        // optimisation
        var dataMap = message._data = new Map();

        var d, property, typeOfProperty;

        for (d in data) {
            if (data.hasOwnProperty(d)) {
                property = data[d];
                typeOfProperty = typeof property;

                if (typeOfProperty === "string") {
                    dataMap.set(d, property);

                } else if (typeOfProperty === "object") {
                    Bindings.defineBinding(dataMap, ".get('" + d + "')", property, {
                        components: deserializer
                    });
                }   
            }
        }

        dataMap.addMapChangeListener(message, "data");
    }

    if (typeof key === "object") {
        Bindings.defineBinding(message, "key", key, {
            components: deserializer
        });
    } else {
        message.key = key;
    }

    if (typeof defaultMessage === "object") {
        Bindings.defineBinding(message, "defaultMessage", defaultMessage, {
            components: deserializer
        });
    } else if (typeof defaultMessage === "string") {
        message.defaultMessage = defaultMessage;
    }

    Bindings.defineBinding(object, prop, {
        // TODO: Remove when possible to bind to promises and replace with
        // binding to "localized"
        "&lt;-": "__localizedResolved",
        source: message,
        serializable: false
    });
};

Serializer.defineSerializationUnit("localizations", function (serializer, object) {
    var bindingDescriptors = FrbBindings.getBindings(object);

    if (bindingDescriptors) {
        var result;
        for (var prop in bindingDescriptors) {
            if (bindingDescriptors.hasOwnProperty(prop)) {
                var desc = bindingDescriptors[prop];
                if (Message.prototype.isPrototypeOf(desc.source)) {
                    if (!result) {
                        result = {};
                    }
                    var message = desc.source;
                    result[prop] = message.serializeForLocalizations(serializer);
                }
            }
        }
        return result;
    }
});

Deserializer.defineDeserializationUnit("localizations", function (deserializer, object, properties) {

    var desc,
        key,
        defaultMessage;

    for (var prop in properties) {
        if (properties.hasOwnProperty(prop)) {

            desc = properties[prop];
            if (!(KEY_KEY in desc)) {
                console.error("localized property '" + prop + "' must contain a key property (" + KEY_KEY + "), in ", properties[prop]);
                continue;
            }
            if(logger.isDebug &amp;&amp; !(DEFAULT_MESSAGE_KEY in desc)) {
                logger.debug(this, "Warning: localized property '" + prop + "' does not contain a default message property (" + DEFAULT_MESSAGE_KEY + "), in ", object);
            }

            key = desc[KEY_KEY];
            defaultMessage = desc[DEFAULT_MESSAGE_KEY];

            createMessageBinding(object, prop, key, defaultMessage, desc.data, deserializer);
        }
    }
});
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="module-_._foo.reel_.html">"./foo.reel"</a></li><li><a href="module-_montage_ui_condition.reel_.html">"montage/ui/condition.reel"</a></li><li><a href="module-_montage_ui_flow.reel_.html">"montage/ui/flow.reel"</a></li><li><a href="module-_montage_ui_input-radio.reel_.html">"montage/ui/input-radio.reel"</a></li><li><a href="module-_montage_ui_label.reel_.html">"montage/ui/label.reel"</a></li><li><a href="module-_montage_ui_loader.reel_.html">"montage/ui/loader.reel"</a></li><li><a href="module-_montage_ui_native_button.reel_.html">"montage/ui/native/button.reel"</a></li><li><a href="module-_montage_ui_native_checkbox.reel_.html">"montage/ui/native/checkbox.reel"</a></li><li><a href="module-_montage_ui_native_image.reel_.html">"montage/ui/native/image.reel"</a></li><li><a href="module-_montage_ui_native_input-date.reel_.html">"montage/ui/native/input-date.reel"</a></li><li><a href="module-_montage_ui_native_input-number.reel_.html">"montage/ui/native/input-number.reel"</a></li><li><a href="module-_montage_ui_native_input-range.reel_.html">"montage/ui/native/input-range.reel"</a></li><li><a href="module-_montage_ui_native_input-text.reel_.html">"montage/ui/native/input-text.reel"</a></li><li><a href="module-_montage_ui_native_progress.reel_.html">"montage/ui/native/progress.reel"</a></li><li><a href="module-_montage_ui_native_select.reel_.html">"montage/ui/native/select.reel"</a></li><li><a href="module-_montage_ui_native_textarea.reel_.html">"montage/ui/native/textarea.reel"</a></li><li><a href="module-_montage_ui_repetition.reel_.html">"montage/ui/repetition.reel"</a></li><li><a href="module-_montage_ui_segmented-bar.reel_.html">"montage/ui/segmented-bar.reel"</a></li><li><a href="module-_montage_ui_slot.reel_.html">"montage/ui/slot.reel"</a></li><li><a href="module-_montage_ui_substitution.reel_.html">"montage/ui/substitution.reel"</a></li><li><a href="module-_montage_ui_succession.reel_.html">"montage/ui/succession.reel"</a></li><li><a href="module-_montage_ui_text.reel_.html">"montage/ui/text.reel"</a></li><li><a href="module-_native_ui_anchor.reel_.html">"native/ui/anchor.reel"</a></li><li><a href="module-_ui_main.reel_.html">"ui/main.reel"</a></li><li><a href="module-_ui_modal-overlay.reel_.html">"ui/modal-overlay.reel"</a></li><li><a href="module-_ui_overlay.reel_.html">"ui/overlay.reel"</a></li><li><a href="module-_ui_segmented-bar.reel_segment.reel_.html">"ui/segmented-bar.reel/segment.reel"</a></li><li><a href="module-core_application.html">core/application</a></li><li><a href="module-montage_composer_composer.html">montage/composer/composer</a></li><li><a href="module-montage_composer_key-composer.html">montage/composer/key-composer</a></li><li><a href="module-montage_composer_press-composer.html">montage/composer/press-composer</a></li><li><a href="module-montage_composer_swipe-composer.html">montage/composer/swipe-composer</a></li><li><a href="module-montage_composer_translate-composer.html">montage/composer/translate-composer</a></li><li><a href="module-montage_core_bindings.html">montage/core/bindings</a></li><li><a href="module-montage_core_bitfield.html">montage/core/bitfield</a></li><li><a href="module-montage_core_converter_bytes-converter.html">montage/core/converter/bytes-converter</a></li><li><a href="module-montage_core_converter_camel-case-converter.html">montage/core/converter/camel-case-converter</a></li><li><a href="module-montage_core_converter_converter.html">montage/core/converter/converter</a></li><li><a href="module-montage_core_converter_currency-converter.html">montage/core/converter/currency-converter</a></li><li><a href="module-montage_core_converter_date-converter.html">montage/core/converter/date-converter</a></li><li><a href="module-montage_core_converter_invert-converter.html">montage/core/converter/invert-converter</a></li><li><a href="module-montage_core_converter_kebab-case-converter.html">montage/core/converter/kebab-case-converter</a></li><li><a href="module-montage_core_converter_lower-case-converter.html">montage/core/converter/lower-case-converter</a></li><li><a href="module-montage_core_converter_new-line-to-br-converter.html">montage/core/converter/new-line-to-br-converter</a></li><li><a href="module-montage_core_converter_number-converter.html">montage/core/converter/number-converter</a></li><li><a href="module-montage_core_converter_number-to-nearest-integer-converter.html">montage/core/converter/number-to-nearest-integer-converter</a></li><li><a href="module-montage_core_converter_snake-case-converter.html">montage/core/converter/snake-case-converter</a></li><li><a href="module-montage_core_converter_trim-converter.html">montage/core/converter/trim-converter</a></li><li><a href="module-montage_core_converter_upper-case-converter.html">montage/core/converter/upper-case-converter</a></li><li><a href="module-montage_core_core.html">montage/core/core</a></li><li><a href="module-montage_core_deprecate.html">montage/core/deprecate</a></li><li><a href="module-montage_core_dom.html">montage/core/dom</a></li><li><a href="module-montage_core_enum.html">montage/core/enum</a></li><li><a href="module-montage_core_event_action-event-listener.html">montage/core/event/action-event-listener</a></li><li><a href="module-montage_core_event_event-manager.html">montage/core/event/event-manager</a></li><li><a href="module-montage_core_event_key-manager.html">montage/core/event/key-manager</a></li><li><a href="module-montage_core_event_mutable-event.html">montage/core/event/mutable-event</a></li><li><a href="module-montage_core_exception.html">montage/core/exception</a></li><li><a href="module-montage_core_extras_date.html">montage/core/extras/date</a></li><li><a href="module-montage_core_extras_function.html">montage/core/extras/function</a></li><li><a href="module-montage_core_extras_object.html">montage/core/extras/object</a></li><li><a href="module-montage_core_extras_string.html">montage/core/extras/string</a></li><li><a href="module-montage_core_gate.html">montage/core/gate</a></li><li><a href="module-montage_core_geometry_cubic-bezier.html">montage/core/geometry/cubic-bezier</a></li><li><a href="module-montage_core_geometry_point.html">montage/core/geometry/point</a></li><li><a href="module-montage_core_localizer.html">montage/core/localizer</a></li><li><a href="module-montage_core_logger.html">montage/core/logger</a></li><li><a href="module-montage_core_meta_validation-rule.html">montage/core/meta/validation-rule</a></li><li><a href="module-montage_core_module-reference.html">montage/core/module-reference</a></li><li><a href="module-montage_core_object-controller.html">montage/core/object-controller</a></li><li><a href="module-montage_core_range-controller.html">montage/core/range-controller</a></li><li><a href="module-montage_core_serialization.html">montage/core/serialization</a></li><li><a href="module-montage_core_serialization_serializer_montage-serializer.html">montage/core/serialization/serializer/montage-serializer</a></li><li><a href="module-montage_core_shim_array.html">montage/core/shim/array</a></li><li><a href="module-montage_core_shim_object.html">montage/core/shim/object</a></li><li><a href="module-montage_core_shim_string.html">montage/core/shim/string</a></li><li><a href="module-montage_core_state-chart.html">montage/core/state-chart</a></li><li><a href="module-montage_core_undo-manager.html">montage/core/undo-manager</a></li><li><a href="module-montage_core_uuid.html">montage/core/uuid</a></li><li><a href="module-montage_data_object-property.html">montage/data/object-property</a></li><li><a href="module-montage_serialization_serialization.html">montage/serialization/serialization</a></li><li><a href="module-montage_ui_base_abstract-button.html">montage/ui/base/abstract-button</a></li><li><a href="module-montage_ui_base_abstract-control.html">montage/ui/base/abstract-control</a></li><li><a href="module-montage_ui_check-control.html">montage/ui/check-control</a></li><li><a href="module-montage_ui_component.html">montage/ui/component</a></li><li><a href="module-montage_ui_control.html">montage/ui/control</a></li><li><a href="module-montage_ui_controller_media-controller.html">montage/ui/controller/media-controller</a></li><li><a href="module-montage_ui_passage.html">montage/ui/passage</a></li><li><a href="module-montage_ui_text-input.html">montage/ui/text-input</a></li><li><a href="montage_ui_base_abstract-image.module_reel.html">reel</a></li><li><a href="montage_ui_base_abstract-select.module_reel.html">reel</a></li><li><a href="montage_ui_base_abstract-slider.module_reel.html">reel</a></li><li><a href="montage_ui_base_abstract-toggle-button.module_reel.html">reel</a></li><li><a href="montage_ui_base_abstract-toggle-switch.module_reel.html">reel</a></li><li><a href="montage_ui_base_abstract-video.module_reel.html">reel</a></li><li><a href="ui_alert.module_reel.html">reel</a></li><li><a href="ui_base_abstract-progress-bar.module_js.html">js</a></li><li><a href="ui_caption.module_reel.html">reel</a></li><li><a href="ui_draggable-square.module_reel.html">reel</a></li><li><a href="ui_list.module_reel.html">reel</a></li><li><a href="ui_main.module_reel.html">reel</a></li><li><a href="ui_montage-studio-loader.module_reel.html">reel</a></li><li><a href="ui_press-composer-layers.module_reel.html">reel</a></li><li><a href="ui_square.module_reel.html">reel</a></li><li><a href="ui_tree-list.module_reel.html">reel</a></li><li><a href="-_rotation-composer.module_reel.html">reel</a></li></ul><h3>Externals</h3><ul><li><a href="external-Array.html">Array</a></li><li><a href="external-Function.html">Function</a></li><li><a href="external-Object.html">Object</a></li><li><a href="external-RegExp.html">RegExp</a></li><li><a href="external-String.html">String</a></li></ul><h3>Classes</h3><ul><li><a href="AbstractCheckbox.html">AbstractCheckbox</a></li><li><a href="AbstractLink.html">AbstractLink</a></li><li><a href="AbstractNumberField.html">AbstractNumberField</a></li><li><a href="AbstractRadioButton.html">AbstractRadioButton</a></li><li><a href="AbstractTextArea.html">AbstractTextArea</a></li><li><a href="AbstractTextField.html">AbstractTextField</a></li><li><a href="Alias.html">Alias</a></li><li><a href="Authorization.html">Authorization</a></li><li><a href="AuthorizationManager.html">AuthorizationManager</a></li><li><a href="AuthorizationService.html">AuthorizationService</a></li><li><a href="BlueprintDataMapping.html">BlueprintDataMapping</a></li><li><a href="ConnectionDescriptor.html">ConnectionDescriptor</a></li><li><a href="DataIdentifier.html">DataIdentifier</a></li><li><a href="DataMapping.html">DataMapping</a></li><li><a href="DataObjectDescriptor.html">DataObjectDescriptor</a></li><li><a href="DataOperation.html">DataOperation</a></li><li><a href="DataOrdering.html">DataOrdering</a></li><li><a href="DataPropertyDescriptor.html">DataPropertyDescriptor</a></li><li><a href="DataProvider.html">DataProvider</a></li><li><a href="DataQuery.html">DataQuery</a></li><li><a href="DataSelector.html">DataSelector</a></li><li><a href="DataService.html">DataService</a></li><li><a href="DataStream.html">DataStream</a></li><li><a href="DerivedDescriptor.html">DerivedDescriptor</a></li><li><a href="ElementReference.html">ElementReference</a></li><li><a href="Enumeration.html">Enumeration</a></li><li><a href="EventDescriptor.html">EventDescriptor</a></li><li><a href="ExpressionDataMapping.html">ExpressionDataMapping</a></li><li><a href="Flow.html">Flow</a></li><li><a href="FlowTranslateComposer.html">FlowTranslateComposer</a></li><li><a href="HttpService.html">HttpService</a></li><li><a href="HttpService.DataType.html">DataType</a></li><li><a href="ImageGallery.html">ImageGallery</a></li><li><a href="ImageGalleryItem.html">ImageGalleryItem</a></li><li><a href="IndexedDBDataService.html">IndexedDBDataService</a></li><li><a href="Main.html">Main</a></li><li><a href="MappingRule.html">MappingRule</a></li><li><a href="Message.html">Message</a></li><li><a href="MessageFormat.html">MessageFormat</a></li><li><a href="Model.html">Model</a></li><li><a href="ModelGroup.html">ModelGroup</a></li><li><a href="module-_._foo.reel_.Foo.html">Foo</a></li><li><a href="module-_montage_ui_condition.reel_-Condition.html">Condition</a></li><li><a href="module-_montage_ui_flow.reel_-Flow.html">Flow</a></li><li><a href="module-_montage_ui_loader.reel_-Loader.html">Loader</a></li><li><a href="module-_montage_ui_native_button.reel_.Button.html">Button</a></li><li><a href="module-_montage_ui_native_checkbox.reel_.Checkbox.html">Checkbox</a></li><li><a href="module-_montage_ui_native_image.reel_.Image.html">Image</a></li><li><a href="module-_montage_ui_native_input-date.reel_.InputDate.html">InputDate</a></li><li><a href="module-_montage_ui_native_input-number.reel_.InputNumber.html">InputNumber</a></li><li><a href="module-_montage_ui_native_input-radio.reel_.InputRadio.html">InputRadio</a></li><li><a href="module-_montage_ui_native_input-range.reel_.InputRange.html">InputRange</a></li><li><a href="module-_montage_ui_native_input-text.reel_.InputText.html">InputText</a></li><li><a href="module-_montage_ui_native_progress.reel_.Progress.html">Progress</a></li><li><a href="module-_montage_ui_native_select.reel_.Select.html">Select</a></li><li><a href="module-_montage_ui_native_textarea.reel_.Textarea.html">Textarea</a></li><li><a href="module-_montage_ui_repetition.reel_-Iteration.html">Iteration</a></li><li><a href="module-_montage_ui_repetition.reel_-Repetition.html">Repetition</a></li><li><a href="module-_montage_ui_segmented-bar.reel_-SegmentedBar.html">SegmentedBar</a></li><li><a href="module-_montage_ui_slot.reel_-Slot.html">Slot</a></li><li><a href="module-_montage_ui_substitution.reel_-Substitution.html">Substitution</a></li><li><a href="module-_montage_ui_succession.reel_-Succession.html">Succession</a></li><li><a href="module-_ui_anchor.reel_.Anchor.html">Anchor</a></li><li><a href="module-_ui_main.reel_.Main.html">Main</a></li><li><a href="module-_ui_modal-overlay.reel_-ModalOverlay.html">ModalOverlay</a></li><li><a href="module-_ui_overlay.reel_-Overlay.html">Overlay</a></li><li><a href="module-_ui_segmented-bar.reel_segment.reel_.Segment.html">Segment</a></li><li><a href="module-core_application-Application.html">Application</a></li><li><a href="module-montage_composer_composer-Composer.html">Composer</a></li><li><a href="module-montage_composer_key-composer-KeyComposer.html">KeyComposer</a></li><li><a href="module-montage_composer_press-composer-PressComposer.html">PressComposer</a></li><li><a href="module-montage_composer_swipe-composer-SwipeComposer.html">SwipeComposer</a></li><li><a href="module-montage_composer_translate-composer-TranslateComposer.html">TranslateComposer</a></li><li><a href="module-montage_core_bitfield-BitField.html">BitField</a></li><li><a href="module-montage_core_converter_bytes-converter-BytesConverter.html">BytesConverter</a></li><li><a href="module-montage_core_converter_camel-case-converter-CamelCaseConverter.html">CamelCaseConverter</a></li><li><a href="module-montage_core_converter_converter-Converter.html">Converter</a></li><li><a href="module-montage_core_converter_converter-Validator.html">Validator</a></li><li><a href="module-montage_core_converter_currency-converter-CurrencyConverter.html">CurrencyConverter</a></li><li><a href="module-montage_core_converter_date-converter-DateConverter.html">DateConverter</a></li><li><a href="module-montage_core_converter_date-converter-DateValidator.html">DateValidator</a></li><li><a href="module-montage_core_converter_invert-converter-InvertConverter.html">InvertConverter</a></li><li><a href="module-montage_core_converter_kebab-case-converter-KebabCaseConverter.html">KebabCaseConverter</a></li><li><a href="module-montage_core_converter_lower-case-converter-LowerCaseConverter.html">LowerCaseConverter</a></li><li><a href="module-montage_core_converter_new-line-to-br-converter-NewLineToBrConverter.html">NewLineToBrConverter</a></li><li><a href="module-montage_core_converter_number-converter-NumberConverter.html">NumberConverter</a></li><li><a href="module-montage_core_converter_number-converter-NumberValidator.html">NumberValidator</a></li><li><a href="module-montage_core_converter_number-to-nearest-integer-converter-NumberToNearestIntegerConverter.html">NumberToNearestIntegerConverter</a></li><li><a href="module-montage_core_converter_snake-case-converter-SnakeCaseConverter.html">SnakeCaseConverter</a></li><li><a href="module-montage_core_converter_trim-converter-ExpressionConverter.html">ExpressionConverter</a></li><li><a href="module-montage_core_converter_trim-converter-TrimConverter.html">TrimConverter</a></li><li><a href="module-montage_core_converter_upper-case-converter-UpperCaseConverter.html">UpperCaseConverter</a></li><li><a href="module-montage_core_core-Montage.html">Montage</a></li><li><a href="module-montage_core_enum-Enum.html">Enum</a></li><li><a href="module-montage_core_event_action-event-listener-ActionEventListener.html">ActionEventListener</a></li><li><a href="module-montage_core_event_event-manager-EventManager.html">EventManager</a></li><li><a href="module-montage_core_event_key-manager-KeyManager.html">KeyManager</a></li><li><a href="module-montage_core_event_mutable-event-MutableEvent.html">MutableEvent</a></li><li><a href="module-montage_core_exception-Exception.html">Exception</a></li><li><a href="module-montage_core_gate-Gate.html">Gate</a></li><li><a href="module-montage_core_geometry_cubic-bezier-CubicBezier.html">CubicBezier</a></li><li><a href="module-montage_core_geometry_point-Point.html">Point</a></li><li><a href="module-montage_core_localizer-Localizer.html">Localizer</a></li><li><a href="module-montage_core_localizer-Message.html">Message</a></li><li><a href="module-montage_core_logger-Logger.html">Logger</a></li><li><a href="module-montage_core_meta_validation-rule-PropertyValidationRule.html">PropertyValidationRule</a></li><li><a href="module-montage_core_module-reference-ModuleReference.html">ModuleReference</a></li><li><a href="module-montage_core_object-controller-ObjectController.html">ObjectController</a></li><li><a href="module-montage_core_range-controller-RangeController.html">RangeController</a></li><li><a href="module-montage_core_state-chart-State.html">State</a></li><li><a href="module-montage_core_state-chart-StateChart.html">StateChart</a></li><li><a href="module-montage_core_uuid-Uuid.html">Uuid</a></li><li><a href="module-montage_data_object-property-ObjectProperty.html">ObjectProperty</a></li><li><a href="module-montage_serialization_serialization-Serialization.html">Serialization</a></li><li><a href="module-montage_serialization_serialization-SerializationExtractor.html">SerializationExtractor</a></li><li><a href="module-montage_serialization_serialization-SerializationInspector.html">SerializationInspector</a></li><li><a href="module-montage_serialization_serialization-SerializationMerger.html">SerializationMerger</a></li><li><a href="module-montage_ui_base_abstract-button-AbstractButton.html">AbstractButton</a></li><li><a href="module-montage_ui_base_abstract-control-AbstractControl.html">AbstractControl</a></li><li><a href="module-montage_ui_check-input.CheckControl.html">CheckControl</a></li><li><a href="module-montage_ui_component-Component.html">Component</a></li><li><a href="module-montage_ui_component-RootComponent.html">RootComponent</a></li><li><a href="module-montage_ui_control.Control.html">Control</a></li><li><a href="module-montage_ui_controller_media-controller-MediaController.html">MediaController</a></li><li><a href="module-montage_ui_passage-Passage.html">Passage</a></li><li><a href="module-montage_ui_text.Text.html">Text</a></li><li><a href="module-montage_ui_text-input.TextInput.html">TextInput</a></li><li><a href="ModuleObjectDescriptor.html">ModuleObjectDescriptor</a></li><li><a href="ModuleReference.html">ModuleReference</a></li><li><a href="montage_ui_base_abstract-image.module_reel-AbstractImage.html">AbstractImage</a></li><li><a href="montage_ui_base_abstract-select.module_reel-AbstractSelect.html">AbstractSelect</a></li><li><a href="montage_ui_base_abstract-slider.module_reel-AbstractSlider.html">AbstractSlider</a></li><li><a href="montage_ui_base_abstract-toggle-button.module_reel-AbstractToggleButton.html">AbstractToggleButton</a></li><li><a href="montage_ui_base_abstract-toggle-switch.module_reel-AbstractToggleSwitch.html">AbstractToggleSwitch</a></li><li><a href="montage_ui_base_abstract-video.module_reel-AbstractVideo.html">AbstractVideo</a></li><li><a href="MontageBuilder.html">MontageBuilder</a></li><li><a href="MontageReviver.html">MontageReviver</a></li><li><a href="ObjectDescriptor.html">ObjectDescriptor</a></li><li><a href="PersistentDataService.html">PersistentDataService</a></li><li><a href="PipelineConverter.html">PipelineConverter</a></li><li><a href="PromiseController.html">PromiseController</a></li><li><a href="PropertyDescriptor.html">PropertyDescriptor</a></li><li><a href="PropertyValidationSemantics.html">PropertyValidationSemantics</a></li><li><a href="RadioButtonController.html">RadioButtonController</a></li><li><a href="RangeController.html">RangeController</a></li><li><a href="RawDataService.html">RawDataService</a></li><li><a href="RawPropertyValueToObjectConverter.html">RawPropertyValueToObjectConverter</a></li><li><a href="SnapshotService.html">SnapshotService</a></li><li><a href="Target.html">Target</a></li><li><a href="Template.html">Template</a></li><li><a href="TemplateResources.html">TemplateResources</a></li><li><a href="ui_alert.module_reel-Alert.html">Alert</a></li><li><a href="ui_base_abstract-progress-bar.module_js-AbstractProgressBar.html">AbstractProgressBar</a></li><li><a href="ui_caption.module_reel-Caption.html">Caption</a></li><li><a href="ui_draggable-square.module_reel-DraggableSquare.html">DraggableSquare</a></li><li><a href="ui_list.module_reel-List.html">List</a></li><li><a href="ui_main.module_reel-Main.html">Main</a></li><li><a href="ui_montage-studio-loader.module_reel-MontageStudioLoader.html">MontageStudioLoader</a></li><li><a href="ui_press-composer-layers.module_reel-PressComposerLayers.html">PressComposerLayers</a></li><li><a href="ui_square.module_reel-Square.html">Square</a></li><li><a href="ui_tree-list.module_reel-TreeList.html">TreeList</a></li><li><a href="UserInterfaceDescriptor.html">UserInterfaceDescriptor</a></li><li><a href="-_rotation-composer.module_reel-RotationComposer.html">RotationComposer</a></li></ul><h3>Events</h3><ul><li><a href="AbstractButton.html#event:action">action</a></li><li><a href="AbstractButton.html#event:longAction">longAction</a></li><li><a href="AbstractCheckbox.html#.event:action">action</a></li><li><a href="AbstractCheckbox.html#event:action">action</a></li><li><a href="AbstractControl.html#event:action">action</a></li><li><a href="AbstractLink.html#.event:action">action</a></li><li><a href="AbstractLink.html#event:action">action</a></li><li><a href="AbstractNumberField.html#event:action">action</a></li><li><a href="AbstractRadioButton.html#.event:action">action</a></li><li><a href="AbstractRadioButton.html#event:action">action</a></li><li><a href="AbstractSelect.html#.event:action">action</a></li><li><a href="AbstractTextField.html#.event:action">action</a></li><li><a href="AbstractTextField.html#event:action">action</a></li><li><a href="AbstractToggleButton.html#.event:action">action</a></li><li><a href="AbstractToggleButton.html#.event:longAction">longAction</a></li><li><a href="AbstractToggleSwitch.html#.event:action">action</a></li><li><a href="module-montage_ui_control.html#~event:longpress">longpress</a></li><li><a href="module-_montage_ui_native_button.reel_.Button.html#.event:action">action</a></li><li><a href="module-_montage_ui_native_button.reel_.Button.html#.event:hold">hold</a></li><li><a href="module-_montage_ui_segmented-bar.reel_-SegmentedBar.html#event:action">action</a></li><li><a href="module-_montage_ui_segmented-bar.reel_-SegmentedBar.html#event:longAction">longAction</a></li><li><a href="module-montage_ui_base_abstract-button-AbstractButton.html#event:action">action</a></li><li><a href="montage_ui_base_abstract-select.module_reel-AbstractSelect.html#event:action">action</a></li><li><a href="montage_ui_base_abstract-slider.module_reel-AbstractSlider.html#event:action">action</a></li><li><a href="montage_ui_base_abstract-toggle-button.module_reel-AbstractToggleButton.html#event:action">action</a></li><li><a href="montage_ui_base_abstract-toggle-switch.module_reel-AbstractToggleSwitch.html#event:action">action</a></li><li><a href="Overlay.html#.event:dismiss">dismiss</a></li><li><a href="PressComposer.html#.event:longPress">longPress</a></li><li><a href="PressComposer.html#.event:press">press</a></li><li><a href="PressComposer.html#.event:pressCancel">pressCancel</a></li><li><a href="PressComposer.html#.event:pressStart">pressStart</a></li><li><a href="RotationComposer.html#.event:rotation">rotation</a></li><li><a href="RotationComposer.html#.event:rotationStart">rotationStart</a></li><li><a href="SegmentedBar.html#event:action">action</a></li><li><a href="UndoManager.html#.event:operationRegistered">operationRegistered</a></li><li><a href="UndoManager.html#.event:redo">redo</a></li><li><a href="UndoManager.html#.event:undo">undo</a></li></ul><h3>Namespaces</h3><ul><li><a href="EventManager.html">EventManager</a></li></ul><h3>Global</h3><ul><li><a href="global.html#_isLinkLoadEventAvailable">_isLinkLoadEventAvailable</a></li><li><a href="global.html#_offlinePrimaryKeys">_offlinePrimaryKeys</a></li><li><a href="global.html#_webkitVersion">_webkitVersion</a></li><li><a href="global.html#addPrimaryKeyDependency">addPrimaryKeyDependency</a></li><li><a href="global.html#AuthorizationPolicy">AuthorizationPolicy</a></li><li><a href="global.html#childrenExpression">childrenExpression</a></li><li><a href="global.html#childrenFromNode">childrenFromNode</a></li><li><a href="global.html#collapseAll">collapseAll</a></li><li><a href="global.html#collapseNode">collapseNode</a></li><li><a href="global.html#compiledSyntax">compiledSyntax</a></li><li><a href="global.html#converters">converters</a></li><li><a href="global.html#createDefaultBlueprintForObject">createDefaultBlueprintForObject</a></li><li><a href="global.html#createDefaultObjectDescriptorForObject">createDefaultObjectDescriptorForObject</a></li><li><a href="global.html#data">data</a></li><li><a href="global.html#deserialize">deserialize</a></li><li><a href="global.html#determinate">determinate</a></li><li><a href="global.html#error">error</a></li><li><a href="global.html#expandAll">expandAll</a></li><li><a href="global.html#expandNode">expandNode</a></li><li><a href="global.html#expression">expression</a></li><li><a href="global.html#fooCount">fooCount</a></li><li><a href="global.html#fulfilled">fulfilled</a></li><li><a href="global.html#group">group</a></li><li><a href="global.html#handleTreeChange">handleTreeChange</a></li><li><a href="global.html#identifier">identifier</a></li><li><a href="global.html#initiallyExpanded">initiallyExpanded</a></li><li><a href="global.html#initMontage">initMontage</a></li><li><a href="global.html#initWithExpression">initWithExpression</a></li><li><a href="global.html#initWithObjects">initWithObjects</a></li><li><a href="global.html#initWithPath">initWithPath</a></li><li><a href="global.html#initWithSyntax">initWithSyntax</a></li><li><a href="global.html#isNodeExpanded">isNodeExpanded</a></li><li><a href="global.html#manager">manager</a></li><li><a href="global.html#MontageInterpreter">MontageInterpreter</a></li><li><a href="global.html#ok">ok</a></li><li><a href="global.html#parameters">parameters</a></li><li><a href="global.html#pending">pending</a></li><li><a href="global.html#progress">progress</a></li><li><a href="global.html#progressState">progressState</a></li><li><a href="global.html#promise">promise</a></li><li><a href="global.html#referenceFromValue">referenceFromValue</a></li><li><a href="global.html#rejected">rejected</a></li><li><a href="global.html#state">state</a></li><li><a href="global.html#syntax">syntax</a></li><li><a href="global.html#value">value</a></li><li><a href="global.html#valueFromReference">valueFromReference</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.3.2</a> on Wed Nov 15 2017 12:53:29 GMT-0800 (PST)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
